-- ------------------------------------------------------
-- Title: Test program for i2c_software.jal
--
-- Author: Joep Suijs, Copyright (c) 2008..2010, all rights reserved.
--
-- Adapted-by: 
--
-- Compiler: >=2.4m
--
-- This file is part of jallib  (http://jallib.googlecode.com)
-- Released under the BSD license (http://www.opensource.org/licenses/bsd-license.php)
--
-- Description: LCD DSM0822A star burst display test program
--
-- Sources:
--
-- Notes: 
--    setup: a dsm0822a display, connected via i2c
--
-- ------------------------------------------------------

;@jallib use chipdef
;@jallib use i2c

-- generic setup (see releated examples for more details)
;@jallib use serial
include serial_hardware
serial_hw_init()
include print
include delay

-- i2c setup
const word _i2c_bus_speed = 1 ; * 100kHz
const bit _i2c_level = true   ; i2c levels (not SMB)

include i2c_software
;include i2c_hardware

i2c_initialize()
                                                                                                                                                    const byte I2C_port = 0
include lcd_dsm0822a
dsm_init()

const byte str1[] = "\nStar ";

var byte State
var byte PrevState

dsm_data = ASCII_CR
print_string(dsm_data, str1);

var byte ch = " "

dsm_indicator_cache = 1

forever loop

   -- 'walk' the strength indicator
   dsm_clear_indicator(DSM_I1 | DSM_I2 | DSM_I3)   -- clear all strength indicators
   dsm_set_indicator(DSM_I1)     -- set left strength indicators
   delay_100ms(3)

   dsm_clear_indicator(DSM_I1)   -- clear the prev indicator   
   dsm_set_indicator(DSM_I2)     -- set the next one
   delay_100ms(3)

   dsm_clear_indicator(DSM_I2)   -- clear the prev indicator   
   dsm_set_indicator(DSM_I3)     -- set the next one
   delay_100ms(3)

   dsm_clear_indicator(DSM_I3)   -- clear the prev indicator   
   delay_100ms(3)
  
   dsm_data = ch        ; put char on display
   ch = ch + 1          ; next char
   if (ch > "_") then   ; if beyond last char
      ch = " "          ; then start over
   end if   

end loop

