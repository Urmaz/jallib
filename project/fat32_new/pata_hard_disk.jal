-- Title: Hard disk library for communicating with parallel ata hard drives
--        with a 40 pin ide connector.
-- Author: Matthew Schinkel - borntechi.com, copyright (c) 2009, all rights reserved.
-- Adapted-by:
-- Compiler: >=2.4k
--
-- This file is part of jallib (http://jallib.googlecode.com)
-- Released under the ZLIB license (http://www.opensource.org/licenses/zlib-license.html)
--
-- Description: this library provides functions for pata/ide hard disk drives.
--
-- Sources:
-- "connecting ide drives by tilmann reh" - http://www.gaby.de/gide/IDE-TCJ.txt
-- IDE hardware reference & information document by alex t. ivopol
-- ATA Attachement with Packet Interface 6 - d1410r3-ATA-ATAPI-6.pdf
--
-- Notes: - If you are not using Alternate Status, Digital Output or Drive Address registers
--          pins cs1 & cs0 can be saved by connecting these ide pins to cs0-high, cs1-low
--          at ide connector. normal operation does not require these pins. Set
--          "CONST BYTE PATA_HD_USE_CS0_CS1_PINS = TRUE" if you will be using
--          these registers
--        - You MUST write full sectors of 512 bytes.
--        - this lib does not do error checking
--
-- Functions descriptions:
-- pata_hd_init                - initialize startup settings, recalibrates drive.
-- pata_hd_start_read          - Get drive ready for reading at specified sector
-- pata_hd_read_data           - Read two bytes from disk.
-- pata_hd_stop_read          - Tell drive you are done reading.
-- pata_hd_start_write         - Get drive ready for writing at specified sector
-- pata_hd_write_data          - Write two bytes to disk
--                             - Data will not be written unless 256 writes are sent.
--                             - There are 512 bytes in a sector
-- pata_hd_write_to_sector_end - Finnish writing the current sector with input byte.
-- pata_hd_stop_write          - Tell drive you are done writing.
-- pata_hd_write_pulse         - Send a number of write pulses to data register,
--                               sending 0's as data.
--                             - Used to get to a certain location in a sector while
--                               writing 0's as data
-- pata_hd_read_pulse          - Send a number of read pulses to data register
--                               without getting any data.
--                             - Used to get to a certain location in a sector.
--
-- Pin-outs - PATA IDE 40 pin connector
-- Power connector - black ground, red +5v, yellow +12v
--                 - 2.5" laptop drives do not need 12v
-- 2,19,22,24,26,30,40 - connect direct to ground
-- 1 - /reset, connect to switch (high 5v for normal operation, low resets drive)
-- 28 - ALE, connect to -> 1k resistor -> 5v
-- 39 - ACT, connect to -> LED -> 1k resistor -> 5v
-- 21,27,20,29,31,32,34, leave not connected
-- 3,5,7,9,11,13,15,17 - D0-D7, connect direct to pata_hd_data_low pins
-- 18,16,14,12,10,8,6,4 - D8-D15, connect direct to pata_hd_data_high pins
-- 23 - /IOW, connect direct to iowr         -- see constant PATA_HD_NO_INVERTER
-- 25 - /IOR, connect direct to pata_hd_iord -- see constant PATA_HD_NO_INVERTER
-- 38 - /cs0, connect direct to pata_hd_cs0 (or gnd) -- see constant PATA_HD_NO_INVERTER & PATA_HD_USE_CS0_CS1_PINS
-- 37 - /cs1, connect direct to pata_hd_cs1 (or 5v) -- see constant PATA_HD_NO_INVERTER & PATA_HD_USE_CS0_CS1_PINS
-- 36 - A2, connect direct to pata_hd_a2
-- 33 - A1, connect direct to pata_hd_a1
-- 35 - A0, connect direct to pata_hd_a0
-- Watch for open drain pins on your pic, use pull-up resistors.
--

-- variables
var byte pata_hd_word_count = 0    -- counts words read from current sector, must be a byte
var byte pata_hd_sector_count = 0  -- counds sectors read, must be a byte.

-- readable/writeable registers
const PATA_HD_DATA_REG = 8        -- data register
const PATA_HD_SEC_COUNT_REG = 10  -- sector count
const PATA_HD_SEC_NUM_REG = 11    -- sector number
const PATA_HD_CYL_LOW_REG = 12    -- cylinder low
const PATA_HD_CYL_HIGH_REG = 13   -- cylinder high
const PATA_HD_SDH_REG = 14        -- sector/drive/head register

-- readable registers
const PATA_HD_ERROR_REG = 9       -- error register
const PATA_HD_STATUS_REG = 15     -- status register  (creates interupt)
const PATA_HD_ALT_STATUS_REG = 16 -- alternate status (no interupt)
const PATA_HD_ADDRESS_REG = 17    -- drive address

-- writeable registers
const PATA_HD_PRECOMP_REG = 9     -- write precomp reg
const PATA_HD_COMMAND_REG = 15    -- command register
const PATA_HD_DODC_REG = 16       -- digital output / device control

-- common commands for command register:
const PATA_HD_RECALIBRATE = 0x10     -- sends drive heads to cyl 0, SC, SN, and SDH are not changed
const PATA_HD_READ_SECTORS = 0x20     -- reads data from sector(s)
const PATA_HD_WRITE_SECTORS = 0x30    -- write data to sector(s)
const PATA_HD_IDENTIFY_DRIVE = 0xEC  -- read drive info such as make/modem/sn/drive size
const PATA_HD_SPIN_DOWN = 0xE0       -- turn off the drive's motor
const PATA_HD_SPIN_UP = 0xE1         -- turn on the drive's motor

-- other constants
-- used for pata_hd_data_request()
const bit PATA_HD_WAIT_READ = 0  -- wait for sector buffer to fill it's contents with data from disk platters
const bit PATA_HD_WAIT_WRITE = 1 -- wait for sector buffer to empty it's contents to disk platters

const PATA_HARD_DISK = 0            -- data media constants for fat32 lib
const SD_CARD = 1
const DATA_MEDIA = PATA_HARD_DISK

-- other vars
var dword pata_hd_sector_select = 0
var bit pata_hd_48_bit_lba_support = false  -- currently this lib does not support drives > 137,438,952,960 bytes (28 bit addressing)
                                            -- "IDENTIFY DEVICE bit 10 word 83 indicates support for 48-bit addressing" - in ata8 pdf
var bit pata_hd_byte_location = 0

-- from "connecting ide drives by tilmann reh" - http://www.gaby.de/gide/ide-tcj.txt
-- List of commands and required parameters:
-- -----------------------------------------------------------------------------
-- command             type  7 6 5 4 3 2 1 0    hex       parameters required
-- -----------------------------------------------------------------------------
-- recalibrate          *    0 0 0 1  (rate)    10-1F     d
-- read sector          *    0 0 1 0 0 m l t    20-27     sc,sn,c,d,h
-- write sector         *    0 0 1 1 0 m l t    30-37     sc,sn,c,d,h
-- scan id / verify     *    0 1 0 0 0 0 0 t    40,41     d,(sc,sn,c,h)
-- write format         *    0 1 0 1 0 0 0 0    50        c,d,h,(sc,sn)
-- seek                 *    0 1 1 1  (rate)    70-7F     c,d,(h)
-- exec diagnostics          1 0 0 1 0 0 0 0    90        d
-- set drive parameters      1 0 0 1 0 0 0 1    91        sc,(c),d,h
-- read multiple        +    1 1 0 0 0 1 0 0    C4        sc,sn,c,d,h
-- write multiple       +    1 1 0 0 0 1 0 1    C5        sc,sn,c,d,h
-- set multiple         +    1 1 0 0 0 1 1 0    C6        sc,d
-- power commands       +    1 1 1 0 0 x x x    E0-E6     sc,d
-- read sector buffer        1 1 1 0 0 1 0 0    E4        d
-- write sector buffer       1 1 1 0 1 0 0 0    E8        d
-- identify drive            1 1 1 0 1 1 0 0    EC        d
-- cache on/off         +    1 1 1 0 1 1 1 1    EF        d,wp
-- power save           +    1 1 1 1 1 x x x    F8-FD     ?

-- ------------------------------------------------
-- register                           abbr.
-- ------------------------------------------------
-- data register                      d
-- error reg. / write precomp. reg.   e / wp
-- sector count                       sc
-- sector number                      sn
-- cylinder low                       c
-- cylinder high                      c
-- sdh (sector size, drive, head)     d,h
-- status reg. / command reg.

-- ----------------------------------------------------------------------------
-- 100ns delay procedure
-- ----------------------------------------------------------------------------
procedure pata_hd_delay_100ns() is
   pragma inline
   if target_clock > 16_000_000 then
      asm nop
   elsif target_clock > 32_000_000 then
      assembler
               local next1
               goto next1  -- Only one instruction that takes
        next1:             -- two instruction cycles ("double-nop")
      end assembler
   elsif target_clock > 50_000_000 then
      assembler
               local next1
               goto next1
        next1: nop
      end assembler
   elsif target_clock > 64_000_000 then
      assembler
               local next1, next2
               goto next1
        next1: goto next2
        next2:
      end assembler
   end if
 end procedure

-- ----------------------------------------------------------------------------
-- Set register select pins to selected register, for internal use only.
-- ----------------------------------------------------------------------------
procedure pata_hd_select_register(byte in register) is	
  -- set register select pins one at a time
  var bit bit0 at register : 0
  var bit bit1 at register : 1
  var bit bit2 at register : 2
  var bit bit3 at register : 3
  var bit bit4 at register : 4

  -- setup data bits
  pata_hd_a0 = bit0
  pata_hd_a1 = bit1
  pata_hd_a2 = bit2
  if PATA_HD_USE_CS0_CS1_PINS == TRUE then
    pata_hd_cs0 = bit3 ^ PATA_HD_NO_INVERTER
    pata_hd_cs1 = bit4 ^ PATA_HD_NO_INVERTER
  end if
end procedure

-- ----------------------------------------------------------------------------
-- Wait for drive to be ready for a data transfer.
-- Sets data pins as inputs or outputs for next read or write.
-- ----------------------------------------------------------------------------
procedure pata_hd_data_request(bit in read_write) is begin
  var bit s
  var bit drq at pata_hd_data_low : 3           -- set drq pin to check
  s = 0
	
  -- set data pins as inputs
  pata_hd_data_low_direction = all_input
  pata_hd_data_high_direction = all_input

  pata_hd_select_register (PATA_HD_STATUS_REG)  -- select status register	

  -- wait for drq in status register to be high.
  -- may get stuck in loop if drq never goes high
  -- you can modify to check for errors or have a time-out
  while s == 0 loop
    pata_hd_iord = high ^ PATA_HD_NO_INVERTER   -- start read pulse
    if drq == high then
      s = 1                                     -- exit loop
    end if
    pata_hd_iord = low ^ PATA_HD_NO_INVERTER    -- end read pulse
  end loop

  -- after drive is ready for data transfer, go to the data register
  pata_hd_select_register (PATA_HD_DATA_REG)

  if read_write == PATA_HD_WAIT_READ then      -- if we are waiting to read data in
    -- do nothing since data pins are already inputs
  else                                         -- if we are waiting to write data out
    -- set data ports to outputs
    pata_hd_data_low_direction = all_output
    pata_hd_data_high_direction = all_output
  end if
end procedure

-- ----------------------------------------------------------------------------
-- Registers may not be accessed unless bsy bit is
-- low due to internal operations.
-- ----------------------------------------------------------------------------
procedure pata_hd_busy() is begin
  var bit s
  s = 1
  var bit bsy at pata_hd_data_low : 7           -- set bsy pin to check
	
  -- set data pins as inputs
  pata_hd_data_low_direction = all_input
  pata_hd_data_high_direction = all_input

  pata_hd_select_register (PATA_HD_STATUS_REG)  -- select status register
	
  -- wait for bsy in status register to be high
  -- may get stuck in loop if bsy never goes low
  -- you can modify to check for errors or have a time-out
  while s == 1 loop
    pata_hd_iord = high ^ PATA_HD_NO_INVERTER   -- start read pulse
    if bsy == low then
      s = 0                                     -- end loop
    end if
    pata_hd_iord = low ^ PATA_HD_NO_INVERTER    -- end read pulse
  end loop
end procedure

-- ----------------------------------------------------------------------------
-- Wait for drive to be up to speed and ready for a command.
-- ----------------------------------------------------------------------------
procedure pata_hd_drive_ready() is begin
  var bit s
  s = 1
  var bit rdy at pata_hd_data_low : 6           -- set rdy pin to check
	
  -- set data pins as inputs
  pata_hd_data_low_direction = all_input
  pata_hd_data_high_direction = all_input
	
  pata_hd_select_register (PATA_HD_STATUS_REG)  -- select status register	
	
  -- wait for rdy in status register to be high
  -- may get stuck in loop if rdy never goes high
  -- you can modify to check for errors or have a time-out
  while s == 1 loop
    pata_hd_iord = high ^ PATA_HD_NO_INVERTER   -- start read pulse
    if rdy == high then
      s = 0                                     -- end loop
    end if
    pata_hd_iord = low ^ PATA_HD_NO_INVERTER    -- end read pulse
  end loop
end procedure

-- ----------------------------------------------------------------------------
-- Select a register and give it a command or data.
-- ----------------------------------------------------------------------------
procedure pata_hd_register_write(byte in register, byte in low_byte) is begin
  var byte high_byte = 0

  -- registers may not be accessed unless drive is not busy
  pata_hd_busy()

  if register == PATA_HD_COMMAND_REG then
    -- make sure the drive is up to speed and ready for a command
    pata_hd_drive_ready()
  end if

  pata_hd_select_register (register)     -- select register

  -- set data ports to outputs
  pata_hd_data_low_direction = all_output
  pata_hd_data_high_direction = all_output	
	
  -- send the data trough the ide interface
  pata_hd_data_low = low_byte                 -- set low data byte
  pata_hd_data_high = high_byte               -- set high data byte
  pata_hd_iowr = high ^ PATA_HD_NO_INVERTER   -- send write pulse
  pata_hd_iowr = low ^ PATA_HD_NO_INVERTER				
end procedure

-- ----------------------------------------------------------------------------
-- Select a register and get data from it.
-- ----------------------------------------------------------------------------
procedure pata_hd_register_read(byte in register, byte out low_byte) is begin
  var byte high_byte

  -- registers may not be accessed unless drive is not busy
  pata_hd_busy()

  pata_hd_select_register (register)     -- select register

  -- set data ports to inputs
  pata_hd_data_low_direction = all_input
  pata_hd_data_high_direction = all_input

  -- get the data trough the ide interface
  pata_hd_iord = high ^ PATA_HD_NO_INVERTER      -- start read pulse
  pata_hd_delay_100ns()                          -- tiny delay
  low_byte = pata_hd_data_low                    -- get low data byte
  high_byte  = pata_hd_data_high                 -- get high data byte
  pata_hd_iord = low ^ PATA_HD_NO_INVERTER       -- end read pulse
end procedure

-- ----------------------------------------------------------------------------
-- Go to a specific sector, select lba/chs mode and master/slave drive
-- Max sector number is 0x0F_FF_FF_FF or the number of sectors the drive has.
-- Max drive size is 0x0F_FF_FF_FF * 512 = 137.439 GB
-- Sector count selects number of sectors that will be read
-- Sector count value of 0 means 256 sectors will be read
-- ----------------------------------------------------------------------------
procedure pata_hd_set_address(byte in pata_hd_head_addr, byte in cyl_high_addr, byte in cyl_low_addr, byte in sec_num_addr, byte in sec_count) is
  -- select lba or chs mode
  var volatile byte  pata_hd_sdh_val    =     0b_1110_0000
  var volatile bit   pata_hd_lba              at pata_hd_sdh_val : 6
  var volatile bit   pata_hd_slave            at pata_hd_sdh_val : 4

  -- select drive options
  pata_hd_lba = true                             -- 1 = lba mode, 0 = chs mode (not tested)
  pata_hd_slave = false                          -- 0 = master,   1 = slave    (not tested)
	
  pata_hd_register_write (PATA_HD_SEC_COUNT_REG,sec_count)     -- set sec count register, sectors to read/write	
  pata_hd_register_write (PATA_HD_SEC_NUM_REG,sec_num_addr)    -- set sec number register address	
  pata_hd_register_write (PATA_HD_CYL_LOW_REG,cyl_low_addr)    -- set cyl low register address	
  pata_hd_register_write (PATA_HD_CYL_HIGH_REG,cyl_high_addr)  -- set cyl high register address		
  -- set sector/drive/head register, head number
  -- pata_hd_head_val address can be 0 to 15
  pata_hd_register_write (PATA_HD_SDH_REG,pata_hd_sdh_val + pata_hd_head_addr)					
end procedure

-- ----------------------------------------------------------------------------
-- Go to a specific sector number (lba mode only)
-- Max sector number is 268435455 or the number of sectors the drive has.
-- Max drive size is 268435455 * 512 = 137.439 GB
-- Sector count selects number of sectors that will be read
-- Sector count value of 0 means 256 sectors will be read
-- ----------------------------------------------------------------------------
procedure pata_hd_go_to_sector(dword in sector, byte in sec_count) is
  var byte sec_num_addr,cyl_low_addr,cyl_high_addr,pata_hd_head_addr

  -- change sector number into bytes
  var byte  dval[4] at sector
  sec_num_addr = dval[0]
  cyl_low_addr = dval[1]
  cyl_high_addr = dval[2]
  pata_hd_head_addr = dval[3]

  -- go to the address
  pata_hd_set_address (pata_hd_head_addr,cyl_high_addr,cyl_low_addr,sec_num_addr,sec_count)
end procedure

-- ----------------------------------------------------------------------------
-- Get drive ready for reading at specified address
-- ----------------------------------------------------------------------------
procedure pata_hd_start_read(dword in address) is
  pata_hd_sector_select = address   -- set the users selected sector
  pata_hd_word_count = 0            -- reset number of words read from sector
  pata_hd_sector_count = 0          -- reset number of sectors read
  pata_hd_byte_location = 0
end procedure

-- ----------------------------------------------------------------------------
-- Read two bytes from disk.
-- ----------------------------------------------------------------------------
procedure pata_hd_read_data(byte out low_byte, byte out high_byte) is
  if (pata_hd_word_count == 0) & (pata_hd_sector_count) == 0 then        -- if we are at beginning of read
    pata_hd_go_to_sector(pata_hd_sector_select,0)                        -- go to the selected sector
    pata_hd_register_write(PATA_HD_COMMAND_REG,PATA_HD_READ_SECTORS)      -- send the read command to the command register	
    pata_hd_data_request(PATA_HD_WAIT_READ)                              -- wait till the drive has data for you
  elsif pata_hd_word_count == 0 then                                     -- if we are at beginning of a sector
    pata_hd_data_request(PATA_HD_WAIT_READ)                              -- wait for data to be ready for read
  end if
  	
  if pata_hd_word_count == 255 then                                      -- if we are at end of current sector
    pata_hd_sector_select = pata_hd_sector_select + 1                    -- increment the selected sector
    pata_hd_sector_count = pata_hd_sector_count + 1                      -- increase sector count
  end if
  	
  pata_hd_word_count = pata_hd_word_count + 1   -- increment words read from current sector
	
  -- get the data trough the ide interface
  pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
  pata_hd_delay_100ns()
  low_byte = pata_hd_data_low                -- get low data byte
  high_byte  = pata_hd_data_high             -- get high data byte
  pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse 	
end procedure

-- ----------------------------------------------------------------------------
-- Read one byte
-- ----------------------------------------------------------------------------
var byte pata_hd_high_byte2
procedure pata_hd_read_data_byte(byte out data_byte) is
  var byte low_byte
  if pata_hd_byte_location == 0 then
     pata_hd_read_data(low_byte,pata_hd_high_byte2)
     data_byte = low_byte
  else
     data_byte = pata_hd_high_byte2
  end if	
  pata_hd_byte_location = pata_hd_byte_location + 1
end procedure

-- ----------------------------------------------------------------------------
-- Read one byte (pseudo var)
-- ----------------------------------------------------------------------------
function pata_hd_data_byte'get() return byte is
  var byte low_byte
  if pata_hd_byte_location == 0 then
     pata_hd_read_data(low_byte,pata_hd_high_byte2)
     pata_hd_byte_location = 1
     return low_byte
  else
     pata_hd_byte_location = 0
     return pata_hd_high_byte2
  end if	
end function

-- ----------------------------------------------------------------------------
-- Send a number of read pulses to data register without getting any data.
-- Goes forward 2 bytes per amount
-- Used to get to the end of a sector or to get to a certain
-- location in a sector.
-- Increment pata_hd_word_count
-- ----------------------------------------------------------------------------
procedure pata_hd_read_pulse(dword in amount) is
  var byte x,y
  for amount loop
    pata_hd_read_data (x,y)                         		
  end loop
  pata_hd_byte_location = 0
end procedure

-- ----------------------------------------------------------------------------
-- goes to next byte instead of word like pata_hd_read_pulse
-- ----------------------------------------------------------------------------
procedure pata_hd_read_pulse_byte(dword in z) is
  var byte low_byte
  for z loop
     if pata_hd_byte_location == 0 then
        pata_hd_read_data(low_byte,pata_hd_high_byte2)
        pata_hd_byte_location = 1
     else
        pata_hd_byte_location = 0
     end if	                 		
  end loop
end procedure

-- ----------------------------------------------------------------------------
-- Tell drive you are done reading
-- ----------------------------------------------------------------------------
procedure pata_hd_stop_read() is
  pragma inline
  ;-- just do something to get the hd led to turn off
  pata_hd_register_write(PATA_HD_COMMAND_REG, 0xE5) -- read power mode
  ;pata_hd_register_write(PATA_HD_COMMAND_REG, 0xE1) -- set media idle
end procedure

-- ----------------------------------------------------------------------------
-- Set hard disk to idle state
-- ----------------------------------------------------------------------------
procedure pata_hd_set_idle() is
  pragma inline
  pata_hd_register_write(PATA_HD_COMMAND_REG, 0xE1) -- set media idle
end procedure

-- ----------------------------------------------------------------------------
-- Get drive ready for writing at specified address
-- ----------------------------------------------------------------------------
procedure pata_hd_start_write(dword in address) is
  pata_hd_sector_select = address
  pata_hd_word_count = 0              -- reset number of words written to sector
  pata_hd_sector_count = 0            -- reset number of sectors written
  pata_hd_byte_location = 0
end procedure

-- ----------------------------------------------------------------------------
-- Write two bytes to disk
-- Data will not be written unless 256 writes are sent.
-- ----------------------------------------------------------------------------
procedure pata_hd_write_data(byte in low_byte, byte in high_byte) is
  if pata_hd_word_count == 0 then                                     -- if we are at beginning of write
    pata_hd_go_to_sector (pata_hd_sector_select,1)                    -- go to the correct sector, set to write 1 sector
    pata_hd_register_write (PATA_HD_COMMAND_REG,PATA_HD_WRITE_SECTORS) -- send the write command to the command register
    pata_hd_data_request(PATA_HD_WAIT_WRITE)                          -- wait till data is ready to be read
  end if
  	
  if pata_hd_word_count == 255 then                                   -- if we are at the end of a sector
     pata_hd_sector_count = pata_hd_sector_count + 1                  -- increment sectors written
     pata_hd_sector_select = pata_hd_sector_select + 1                -- increment the selected sector
  end if
  
  pata_hd_word_count = pata_hd_word_count + 1    -- increment words written to disk
	
  -- send the data trough the ide interface
  pata_hd_data_low = low_byte                    -- set low data byte
  pata_hd_data_high = high_byte                  -- set high data byte
  pata_hd_iowr = high ^ PATA_HD_NO_INVERTER      -- send write pulse
  pata_hd_iowr = low ^ PATA_HD_NO_INVERTER 	  	
end procedure

-- ----------------------------------------------------------------------------
-- Write one byte to disk
-- Data will not be written unless 256 writes are sent.
-- ----------------------------------------------------------------------------
var byte pata_hd_high_byte3
procedure pata_hd_write_data_byte(byte in data_byte) is
  if pata_hd_byte_location == 0 then
     pata_hd_high_byte3 = data_byte
       pata_hd_byte_location = 1
  else
     pata_hd_write_data(pata_hd_high_byte3,data_byte)
       pata_hd_byte_location = 0
  end if	
end procedure

-- ----------------------------------------------------------------------------
-- Write one byte to disk pseudo var
-- ----------------------------------------------------------------------------
procedure pata_hd_data_byte'put(byte in data_byte) is
  if pata_hd_byte_location == 0 then
     pata_hd_high_byte3 = data_byte
       pata_hd_byte_location = 1
  else
     pata_hd_write_data(pata_hd_high_byte3,data_byte)
       pata_hd_byte_location = 0
  end if	
end procedure

-- ----------------------------------------------------------------------------
-- Send a number of write pulses to data register sending 0's as data.
-- Used to get to the end of a sector or to get to a certain
-- location in a sector.
-- Increment pata_hd_word_count
-- ----------------------------------------------------------------------------
procedure pata_hd_write_pulse( byte in z ) is begin
  for z loop -- send write pulse z number of times
    pata_hd_write_data (0,0)
  end loop
end procedure

-- ----------------------------------------------------------------------------
-- goes to next byte instead of word like pata_hd_write_pulse
-- ----------------------------------------------------------------------------
procedure pata_hd_write_pulse_byte(dword in z) is
  for z loop
    if pata_hd_byte_location == 1 then
       pata_hd_write_data (pata_hd_high_byte3,0)
       pata_hd_byte_location = 0
    else
       pata_hd_write_data (0,0)
       pata_hd_byte_location = 1
    end if                     		
  end loop
end procedure

-- ----------------------------------------------------------------------------
-- Finnish writing the current sector with input byte.
-- ----------------------------------------------------------------------------
procedure pata_hd_write_to_sector_end(byte in input_byte) is
  var byte x
  x = 0 - pata_hd_word_count -- calculate how many words are left to write to current sector
  for x loop                 -- loop till end of sector
    pata_hd_write_data(input_byte, input_byte) -- write 2 bytes
  end loop
end procedure

-- ----------------------------------------------------------------------------
-- Tell drive you are done writing
-- ----------------------------------------------------------------------------
procedure pata_hd_stop_write() is
   if pata_hd_byte_location == 1 then
      pata_hd_data_byte = 0
   end if
   pata_hd_write_to_sector_end(0)
   pata_hd_stop_read() -- same as stop read
end procedure

-- ----------------------------------------------------------------------------
-- initialize startup settings
-- ----------------------------------------------------------------------------
procedure pata_hd_init() is begin
  -- set startup setting for read/read pins
	pata_hd_iowr = low ^ PATA_HD_NO_INVERTER   -- start write pulse pin low
  pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- start read pulse pin low
  pata_hd_register_write (PATA_HD_COMMAND_REG,PATA_HD_RECALIBRATE) -- recalibrate the drive
end procedure

---------------------------------------------------------------------------
-- define the sector buffer
---------------------------------------------------------------------------
var byte pata_hd_sector_buffer_lo[256] -- 256 low bytes
var byte pata_hd_sector_buffer_hi[256] -- 256 high bytes
function pata_hd_sector_buffer'get(word in address) return byte is
    pragma inline
    if bit(address) == 0 then
       return pata_hd_sector_buffer_lo[address / 2]
    else
       return pata_hd_sector_buffer_hi[(address / 2)]
    end if
 end function

---------------------------------------------------------------------------
-- For faster reading in pata_hd_read_sector procedures
---------------------------------------------------------------------------
procedure _pata_read_512() is
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	0	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	0	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	1	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	1	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	2	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	2	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	3	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	3	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	4	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	4	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	5	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	5	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	6	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	6	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	7	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	7	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	8	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	8	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	9	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	9	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	10	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	10	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	11	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	11	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	12	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	12	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	13	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	13	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	14	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	14	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	15	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	15	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	16	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	16	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	17	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	17	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	18	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	18	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	19	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	19	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	20	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	20	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	21	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	21	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	22	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	22	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	23	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	23	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	24	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	24	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	25	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	25	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	26	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	26	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	27	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	27	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	28	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	28	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	29	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	29	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	30	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	30	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	31	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	31	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	32	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	32	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	33	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	33	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	34	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	34	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	35	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	35	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	36	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	36	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	37	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	37	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	38	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	38	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	39	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	39	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	40	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	40	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	41	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	41	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	42	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	42	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	43	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	43	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	44	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	44	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	45	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	45	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	46	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	46	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	47	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	47	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	48	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	48	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	49	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	49	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	50	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	50	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	51	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	51	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	52	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	52	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	53	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	53	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	54	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	54	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	55	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	55	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	56	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	56	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	57	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	57	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	58	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	58	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	59	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	59	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	60	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	60	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	61	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	61	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	62	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	62	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	63	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	63	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	64	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	64	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	65	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	65	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	66	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	66	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	67	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	67	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	68	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	68	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	69	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	69	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	70	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	70	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	71	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	71	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	72	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	72	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	73	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	73	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	74	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	74	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	75	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	75	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	76	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	76	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	77	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	77	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	78	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	78	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	79	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	79	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	80	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	80	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	81	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	81	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	82	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	82	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	83	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	83	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	84	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	84	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	85	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	85	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	86	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	86	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	87	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	87	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	88	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	88	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	89	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	89	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	90	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	90	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	91	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	91	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	92	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	92	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	93	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	93	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	94	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	94	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	95	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	95	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	96	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	96	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	97	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	97	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	98	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	98	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	99	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	99	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	100	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	100	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	101	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	101	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	102	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	102	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	103	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	103	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	104	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	104	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	105	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	105	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	106	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	106	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	107	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	107	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	108	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	108	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	109	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	109	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	110	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	110	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	111	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	111	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	112	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	112	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	113	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	113	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	114	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	114	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	115	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	115	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	116	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	116	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	117	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	117	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	118	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	118	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	119	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	119	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	120	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	120	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	121	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	121	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	122	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	122	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	123	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	123	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	124	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	124	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	125	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	125	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	126	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	126	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	127	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	127	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	128	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	128	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	129	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	129	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	130	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	130	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	131	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	131	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	132	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	132	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	133	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	133	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	134	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	134	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	135	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	135	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	136	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	136	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	137	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	137	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	138	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	138	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	139	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	139	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	140	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	140	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	141	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	141	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	142	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	142	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	143	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	143	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	144	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	144	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	145	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	145	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	146	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	146	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	147	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	147	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	148	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	148	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	149	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	149	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	150	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	150	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	151	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	151	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	152	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	152	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	153	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	153	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	154	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	154	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	155	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	155	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	156	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	156	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	157	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	157	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	158	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	158	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	159	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	159	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	160	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	160	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	161	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	161	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	162	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	162	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	163	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	163	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	164	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	164	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	165	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	165	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	166	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	166	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	167	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	167	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	168	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	168	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	169	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	169	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	170	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	170	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	171	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	171	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	172	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	172	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	173	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	173	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	174	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	174	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	175	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	175	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	176	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	176	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	177	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	177	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	178	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	178	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	179	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	179	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	180	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	180	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	181	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	181	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	182	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	182	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	183	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	183	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	184	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	184	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	185	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	185	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	186	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	186	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	187	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	187	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	188	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	188	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	189	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	189	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	190	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	190	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	191	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	191	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	192	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	192	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	193	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	193	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	194	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	194	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	195	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	195	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	196	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	196	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	197	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	197	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	198	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	198	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	199	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	199	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	200	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	200	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	201	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	201	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	202	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	202	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	203	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	203	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	204	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	204	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	205	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	205	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	206	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	206	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	207	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	207	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	208	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	208	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	209	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	209	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	210	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	210	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	211	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	211	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	212	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	212	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	213	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	213	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	214	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	214	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	215	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	215	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	216	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	216	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	217	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	217	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	218	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	218	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	219	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	219	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	220	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	220	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	221	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	221	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	222	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	222	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	223	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	223	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	224	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	224	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	225	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	225	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	226	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	226	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	227	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	227	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	228	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	228	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	229	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	229	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	230	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	230	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	231	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	231	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	232	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	232	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	233	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	233	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	234	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	234	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	235	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	235	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	236	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	236	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	237	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	237	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	238	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	238	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	239	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	239	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	240	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	240	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	241	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	241	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	242	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	242	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	243	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	243	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	244	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	244	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	245	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	245	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	246	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	246	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	247	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	247	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	248	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	248	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	249	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	249	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	250	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	250	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	251	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	251	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	252	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	252	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	253	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	253	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	254	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	254	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_lo[	255	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_hi[	255	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read
end procedure

---------------------------------------------------------------------------
-- read one entire sector
---------------------------------------------------------------------------
procedure pata_hd_read_sector() is
   var word count1
   pata_hd_word_count = 0

   if pata_hd_sector_count == 0 then
     pata_hd_go_to_sector(pata_hd_sector_select,0)
     pata_hd_register_write(PATA_HD_COMMAND_REG,PATA_HD_READ_SECTORS)
   end if

   pata_hd_data_request(PATA_HD_WAIT_READ)

   -- get sector data
   if defined(PATA_HD_READ_EXTRA_SPEED) == TRUE then
      if PATA_HD_READ_EXTRA_SPEED == TRUE then
         _pata_read_512()
      else
         for 256 using count1 loop -- NOTE: now "using count1"
            -- get the data trough the ide interface
            pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
            pata_hd_delay_100ns()
            pata_hd_sector_buffer_lo[count1] = pata_hd_data_low  -- get low data
            pata_hd_sector_buffer_hi[count1] = pata_hd_data_high -- get high data
            pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
         end loop
      end if
   else
      for 256 using count1 loop -- NOTE: now "using count1"
         -- get the data trough the ide interface
         pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
         pata_hd_delay_100ns()
         pata_hd_sector_buffer_lo[count1] = pata_hd_data_low  -- get low data
         pata_hd_sector_buffer_hi[count1] = pata_hd_data_high -- get high data
         pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
      end loop
   end if

   pata_hd_sector_select = pata_hd_sector_select + 1
   pata_hd_sector_count = pata_hd_sector_count + 1
end procedure

--------------------------------------------------------------------------------
-- read one entire sector at address. no need for start_read/stop_read
--------------------------------------------------------------------------------
var dword pata_hd_last_sector
var byte pata_hd_sector_count2 = 0
var dword pata_hd_prev_address = 0
var dword pata_hd_current_address = 0xFF_FF_FF_FF
procedure pata_hd_read_sector_address(dword in address) is
   if !(address == pata_hd_current_address) then
      pata_hd_start_read(address)
   end if

   var word count1
   pata_hd_word_count = 0

   -- check if we are at the correct sector already
   -- if not, go to the sector and start reading
   if (!(pata_hd_last_sector + 1 == pata_hd_sector_select)) | (pata_hd_sector_count2 == 0) then       -- if we are at beginning of read
      pata_hd_go_to_sector(pata_hd_sector_select,0)                        -- go to the selected sector
      pata_hd_register_write(PATA_HD_COMMAND_REG,PATA_HD_READ_SECTORS)     -- send the read command to the command register	
   end if

   pata_hd_data_request(PATA_HD_WAIT_READ) -- wait for data to be ready for read before each sector

   -- get sector data
   if defined(PATA_HD_READ_EXTRA_SPEED) == TRUE then
      if PATA_HD_READ_EXTRA_SPEED == TRUE then
         _pata_read_512()
      else
         for 256 using count1 loop -- NOTE: now "using count1"
            -- get the data trough the ide interface
            pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
            pata_hd_delay_100ns()
            pata_hd_sector_buffer_lo[count1] = pata_hd_data_low  -- get low data
            pata_hd_sector_buffer_hi[count1] = pata_hd_data_high -- get high data
            pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
         end loop
      end if
   else
      for 256 using count1 loop -- NOTE: now "using count1"
         -- get the data trough the ide interface
         pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
         pata_hd_delay_100ns()
         pata_hd_sector_buffer_lo[count1] = pata_hd_data_low  -- get low data
         pata_hd_sector_buffer_hi[count1] = pata_hd_data_high -- get high data
         pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
      end loop
   end if

   pata_hd_last_sector = pata_hd_sector_select
   pata_hd_sector_select = pata_hd_sector_select + 1  -- increment the selected sector
   pata_hd_sector_count = pata_hd_sector_count + 1    -- increase sector count
   pata_hd_sector_count2 = pata_hd_sector_count2 + 1    -- increase sector count2

   pata_hd_current_address = address + 1
end procedure







