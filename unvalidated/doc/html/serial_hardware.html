<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
    <head>
    </head>
    <body>
		        <div id="page">
        
            <div id="pagecontent">

			    
    <h1>serial_hardware</h1>

    <div>
		<font size="+1"><i>USART hardware control</i></font>
	</div>

	<br/>

    <div class="narrow">
        
	<table>
	<tr>
		<td style="border: 1px solid #aaa; padding: 5px;">
			<b>Author</b>
		</td>
		<td style="border: 1px solid #aaa; padding: 5px;">
			Stef Mientki, Copyright (c) 2002..2006, all rights reserved.
		</td>
	</tr>
	<tr>
		<td style="border: 1px solid #aaa; padding: 5px;">
			<b>Adapted-by</b>
		</td>
		<td style="border: 1px solid #aaa; padding: 5px;">
			Sebastien Lelong.
		</td>
	</tr>
	<tr>
		<td style="border: 1px solid #aaa; padding: 5px;">
			<b>Compiler</b>
		</td>
		<td style="border: 1px solid #aaa; padding: 5px;">
			>=2.4g
		</td>
	</tr>
	</table>

	<br/>
	
	<b>Description</b>
	<p>
		USART hardware control.<br/>Routines for sending and receiving through the PIC-usart,<br/>both RS232 and SPI are supported (for SPI see spi_hardware.jal)<br/>Baudrate can simply be set through a human constant,<br/>because the baudrate depending registers are calculated by this unit.<br/>Baudrate is calculated, starting at the high baudrate flag,<br/>which will ensure the highest possible accuracy.<br/>SPI routines are setup for more SPI-devices,<br/>in which case CS should be controled outside this unit.<br/>

	</p>
	<br/>


	
	<b>Dependencies</b>
	<p>
		<i>No depency found</i>
	</p>
	<br/>


			<br/>
				<h2><a name="summary">Summary</a></h2>

		<h3><a name="Global variables/contants">Global variables/contants</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a href="#7e7bd093986a593d33e77e96302c24e8">var volatile bit serial_hw_data_ready	 is PIR1_TXIF
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#e80cbd56e0db4e631e79e3a6e308cc49">var volatile bit serial_hw_data_available is PIR1_RCIF
</a></code></b>
		</li>
	</ul>


		<h3><a name="Procedures">Procedures</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a href="#9c4436d14f56c4adcbe5c8ed9df54543">serial_hw_data'put(byte in data)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#c226cf7c88d829d242f6fa20db05aaa1">serial_hw_init()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#7dae159ab02bbd43afeeb7ca142fc0bf">serial_hw_write_word(word in data)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#8bd2c619e16d85ae1bee277645842959">serial_hw_write(byte in data)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#1a1121c18d13250b587ce73e505d0498">serial_hw_data_raw'put(byte in data)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#264dd60fd05fd46f4277464c644c0a93">serial_hw_enable()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#413f90937204bbfdb18553c6b6cd64e8">serial_hw_disable()</a></code></b>
		</li>
	</ul>

	<i><small>Private</small></i>
		<ul>
		<li>
				<b><code name="code" class="python"><a href="#fbc4399fa154b563eb2ae292bb279477">_calculate_and_set_baudrate()</a></code></b>
		</li>
	</ul>

	<br/>

		<h3><a name="Functions">Functions</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a href="#d634974eb95dab7b188c1f605747583a">serial_hw_read(byte out data) return bit</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#53a6c21cd59de67adb0fb30ceed24834">serial_hw_data'get() return byte</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#5a212ee47d076055884f40b9ab9fca90">serial_hw_data_raw'get() return byte</a></code></b>
		</li>
	</ul>



			<br/>
				<h2><a name="api">API details</a></h2>

		<h3><a name="Global variables/contants">Global variables/contants</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a name="7e7bd093986a593d33e77e96302c24e8" href="#summary">var volatile bit serial_hw_data_ready	 is PIR1_TXIF
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="e80cbd56e0db4e631e79e3a6e308cc49" href="#summary">var volatile bit serial_hw_data_available is PIR1_RCIF
</a></code></b>
				<p>	--------------------------------------------------------------------<br/>some variables made available under a general (pic-independant) name<br/>--------------------------------------------------------------------<br/>
</p>
		</li>
	</ul>


		<h3><a name="Procedures">Procedures</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a name="9c4436d14f56c4adcbe5c8ed9df54543" href="#summary">serial_hw_data'put(byte in data)</a></code></b>
				<p>	--------------------------------------------------------------------<br/>Here Serial read and write are definied as pseudo variables<br/>so you use them as normal vars, like<br/><blockquote>-- wait for character being received,-- then echo the inverted characterserial_hw_data = ! serial_hw_data</blockquote><br/>these procedures will wait till they can perform their action<br/>therefor it's better to use to following construct<br/><blockquote>-- if charater received, echo the inverted characterif  serial_hw_data_available thenserial_hw_data = ! serial_hw_dataend if-- do other things</blockquote>--------------------------------------------------------------------<br/>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="c226cf7c88d829d242f6fa20db05aaa1" href="#summary">serial_hw_init()</a></code></b>
				<p>	--------------------------------------------------------------------<br/>Initializes the RS232 port, calculates baudrate registers.<br/>Normally this routine should not be called by the user program,<br/>it's called just once at the end of this unit<br/>Only after &quot;asynch_disable_hw&quot; it's necessary to call this routine,<br/>to enable the RS232 hardware again.<br/>--------------------------------------------------------------------<br/>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="7dae159ab02bbd43afeeb7ca142fc0bf" href="#summary">serial_hw_write_word(word in data)</a></code></b>
				<p>	--------------------------------------------------------------------<br/>like Serial_H_write, but then with a word as input<br/>The MSB is outputed first<br/>--------------------------------------------------------------------<br/>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="8bd2c619e16d85ae1bee277645842959" href="#summary">serial_hw_write(byte in data)</a></code></b>
				<p>	--------------------------------------------------------------------<br/>Asynchronuous RS232 send routine, using the TX pin<br/>Sends byte X (8 bit with no parity) to the serial port<br/>First checks (and waits if necessary) if transmit buffer is empty<br/><br/>remark: PIR1-register (containing TXIF-flag) must be in bank0 !!<br/>--------------------------------------------------------------------<br/>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="1a1121c18d13250b587ce73e505d0498" href="#summary">serial_hw_data_raw'put(byte in data)</a></code></b>
				<p>	--------------------------------------------------------------------<br/>These are real raw procedures, declared as pseudo variables<br/>the user is totally responsible for testing the transmit/receive<br/>flag before using these functions<br/>--------------------------------------------------------------------<br/>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="264dd60fd05fd46f4277464c644c0a93" href="#summary">serial_hw_enable()</a></code></b>
				<p>	--------------------------------------------------------------------<br/>Enables USART (wether used as RS232 or SPI),<br/>--------------------------------------------------------------------<br/>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="413f90937204bbfdb18553c6b6cd64e8" href="#summary">serial_hw_disable()</a></code></b>
				<p>	--------------------------------------------------------------------<br/>Disables USART (wether used as RS232 or SPI),<br/>so ports can be used (temporary) for other purposes.<br/>USART can be enabled again by calling serial_hw_enable()<br/>--------------------------------------------------------------------<br/>
</p>
		</li>
	</ul>

	<i><small>Private</small></i>
		<ul>
		<li>
				<b><code name="code" class="python"><a name="fbc4399fa154b563eb2ae292bb279477" href="#summary">_calculate_and_set_baudrate()</a></code></b>
				<p>	--------------------------------------------------------------------<br/>internal function, calculates and sets baudrate divider<br/>and stores it in the appropiate register.<br/>the high-speed / low-speed bit is not stored but returned as the result<br/><br/>Special attention is payed to the highest and lowest baudrates,<br/>a deviation of 5% is accepted in these cases<br/><br/>Asynchronous baudrate settings (see also page 74/75 of DS40300B)<br/><br/>if TXSTA_BRGH = 0 (low speed)<br/><blockquote>SPBRG = ( Fosc / ( 64 <b> Baudrate ) ) -1<br/><br/>if TXSTA_BRGH = 1 (high speed)<br/><blockquote>SPBRG = ( Fosc / ( 16 * Baudrate ) ) -1</blockquote><br/>Synchronous baudrate settings<br/>TXSTA_BRGH = 0 (low speed)<br/><blockquote>SPBRG = ( Fosc / ( 4 * Baudrate ) ) -1</blockquote>--------------------------------------------------------------------<br/></b></blockquote>
</p>
		</li>
	</ul>

	<br/>

		<h3><a name="Functions">Functions</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a name="d634974eb95dab7b188c1f605747583a" href="#summary">serial_hw_read(byte out data) return bit</a></code></b>
				<p>	--------------------------------------------------------------------<br/>Returns true if a character was received, otherwise returns false.<br/>Overrun error flag is cleared.<br/>--------------------------------------------------------------------<br/>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="53a6c21cd59de67adb0fb30ceed24834" href="#summary">serial_hw_data'get() return byte</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="5a212ee47d076055884f40b9ab9fca90" href="#summary">serial_hw_data_raw'get() return byte</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
	</ul>



			<br/>
				<h2><a name="related_samples">Related samples</a></h2>
	Here are the list of samples which use this library:<br/><br/>
	<ul>
		<li><a href="http://code.google.com/p/jallib/source/browse/trunk/unvalidated/sample/jal/print_serial_numbers_16f877a.jal" target="_blank">print_serial_numbers_16f877a.jal</a></li>
		<li><a href="http://code.google.com/p/jallib/source/browse/trunk/unvalidated/sample/peripheral/adc/adc_lowres.jal" target="_blank">adc_lowres.jal</a></li>
		<li><a href="http://code.google.com/p/jallib/source/browse/trunk/unvalidated/sample/jal/print_serial_numbers_16f88.jal" target="_blank">print_serial_numbers_16f88.jal</a></li>
		<li><a href="http://code.google.com/p/jallib/source/browse/trunk/unvalidated/sample/peripheral/data_eeprom/remember_me.jal" target="_blank">remember_me.jal</a></li>
		<li><a href="http://code.google.com/p/jallib/source/browse/trunk/unvalidated/sample/jal/delay_basic.jal" target="_blank">delay_basic.jal</a></li>
		<li><a href="http://code.google.com/p/jallib/source/browse/trunk/unvalidated/sample/peripheral/usart/echo.jal" target="_blank">echo.jal</a></li>
	</ul>

			<br/>

            </div>
        </div>


	</body>
</html>

