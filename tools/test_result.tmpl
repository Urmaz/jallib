##
## Title: template for test result page (per PIC)
## Author: Sebastien Lelong, Copyright (c) 2008, all rights reserved.
## Adapted-by:
## Compiler:
## 
## This file is part of jallib (http://jallib.googlecode.com)
## Released under the BSD license (http://www.opensource.org/licenses/bsd-license.php)
## 
## Description: template to create test results page for each PIC
##              

#def header
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
	 <head>
	 </head>
	 <body>
	 <h1>$picname.upper() test results</h1>
#end def

#def device
	<h3>Device file</h3>
	<i>some details about device files</i>
#end def

#def meter
   #set note = int($compute_meter($data))
   #set label = $get_meter_label($note)
	<h3>Jallib-O-Meter</h3>
   <img src="http://chart.apis.google.com/chart?chs=225x125&cht=gom&chd=t:$note&chl=$label&nonsense=t${picname}.png"/>
#end def

#def liboverview
	#set true_libs = set($data['libs'][True])
	#set none_libs = set($data['libs'][None]).difference(true_libs)
	#set false_libs = set($data['libs'][False]).difference(none_libs).difference(true_libs)
	<h3>Libraries involved in tests</h2>
	<table width="50%" border="1">
	<tr valign="top">
		<td><b>success</b></td>
		#set disp = ", ".join(sorted(true_libs))
		<td><span style="color:green;">$disp</span></td>
	</tr>
	<tr valign="top">
		<td><b>untested</b></td>
		#set disp = ", ".join(sorted(none_libs))
		<td><span style="color:blue;">$disp</span></td>
	</tr>
	<tr valign="top">
		<td><b>failed</b></td>
		#set disp = ", ".join(sorted(false_libs))
		<td><span style="color:red;">$disp</span></td>
	</tr>
	</table>
#end def

#def testoverview
	<h3>Tests overview</h3>
	#set true,false,none = $sample_stat($data)
	#set sample_num = sum([true,false,none])
	<table>
	<tr>
		<td width="1%" align="right"><b>$sample_num</b></td>
		<td>samples available for this chip</td>
	</tr>
	<tr>
		<td width="1%" align="right"><span style="color:green;">$true</span></td>
		<td>sample(s) successfully tested</td>
	</tr>
	<tr>
		<td width="1%" align="right"><span style="color:blue;">$none</span></td>
		<td>sample(s) not tested yet</td>
	</tr>
	<tr>
		<td width="1%" align="right"><span style="color:red;">$false</span></td>
		<td>sample(s) failed</td>
	</tr>
	</table>
#end def

#def summary
	<h2>Summary</h2>
	<table>
	<tr valign="top"><td>$meter</td><td>$testoverview</td></tr>
	<tr><td colspan="2">$liboverview</td></tr>
	<tr><td colspan="2">$device</td></tr>
	</table>
#end def

#def details
	<h2>Details</h2>
	<table>
	<tr>
		<th>Test file</th>
		<th>Result (revision)</th>
		<th>Used libraries</th>
	</tr>
	#for name,res in sorted($data['samples'].items(),cmp=lambda x,y: cmp(x[0],y[0]))
	<tr>
		<td>$name</td>
		#set disp = ", ".join(res['libs'])
		#set rev = res['revision'] or "unknown"
		#set tpass = '<span style="color:blue;">???</span>'
		#if res['pass'] is True
			#silent tpass = '<span style="color:green;">OK</span>'
		#elif res['pass'] is False
			#silent tpass = '<span style="color:red;">KO</span>'
		#end if
		<td>$tpass ($rev)</td>
		<td>$disp</td>
	</tr>
	#end for
	</table>
#end def

#def results
   $summary
   <br/>
   $details
#end def

#def footer
	</body>
</html>
#end def

#def main
   $header
   $results
   $footer
#end def
