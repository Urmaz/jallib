<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
    <head>
    </head>
    <body>
		        <div id="page">
        
            <div id="pagecontent">

			    
    <h1>serial_hardware</h1>

    <div>
		<font size="+1"><i>USART hardware control</i></font>
	</div>

	<br/>

    <div class="narrow">
        
	<table>
	<tr>
		<td style="border: 1px solid #aaa; padding: 5px;">
			<b>Author</b>
		</td>
		<td style="border: 1px solid #aaa; padding: 5px;">
			Stef Mientki, Copyright (c) 2002..2006, all rights reserved.
		</td>
	</tr>
	<tr>
		<td style="border: 1px solid #aaa; padding: 5px;">
			<b>Adapted-by</b>
		</td>
		<td style="border: 1px solid #aaa; padding: 5px;">
			Sebastien Lelong.
		</td>
	</tr>
	<tr>
		<td style="border: 1px solid #aaa; padding: 5px;">
			<b>Compiler</b>
		</td>
		<td style="border: 1px solid #aaa; padding: 5px;">
			>=2.4g
		</td>
	</tr>
	</table>

	<br/>
	
	<b>Description</b>
	<p>
		<pre>USART hardware control.
Routines for sending and receiving through the PIC-usart,
both RS232 and SPI are supported (for SPI see spi_hardware.jal)
Baudrate can simply be set through a human constant,
because the baudrate depending registers are calculated by this unit.
Baudrate is calculated, starting at the high baudrate flag,
which will ensure the highest possible accuracy.
SPI routines are setup for more SPI-devices,
in which case CS should be controled outside this unit.
</pre>

	</p>
	<br/>


	
	<b>Dependencies</b>
	<p>
		<i>No dependency found</i>
	</p>
	<br/>


			<br/>
				<h2><a name="summary">Summary</a></h2>

		<h3><a name="Global variables/contants">Global variables/contants</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a href="#e80cbd56e0db4e631e79e3a6e308cc49">var volatile bit serial_hw_data_available is PIR1_RCIF
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#eb6c35235eaf81d6929b69ba86d2a9b5">var volatile bit serial_hw_data_ready is PIR1_TXIF
</a></code></b>
		</li>
	</ul>


		<h3><a name="Procedures">Procedures</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a href="#9c4436d14f56c4adcbe5c8ed9df54543">serial_hw_data'put(byte in data)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#c226cf7c88d829d242f6fa20db05aaa1">serial_hw_init()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#7dae159ab02bbd43afeeb7ca142fc0bf">serial_hw_write_word(word in data)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#8bd2c619e16d85ae1bee277645842959">serial_hw_write(byte in data)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#1a1121c18d13250b587ce73e505d0498">serial_hw_data_raw'put(byte in data)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#264dd60fd05fd46f4277464c644c0a93">serial_hw_enable()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#413f90937204bbfdb18553c6b6cd64e8">serial_hw_disable()</a></code></b>
		</li>
	</ul>

	<i><small>Private</small></i>
		<ul>
		<li>
				<b><code name="code" class="python"><a href="#fbc4399fa154b563eb2ae292bb279477">_calculate_and_set_baudrate()</a></code></b>
		</li>
	</ul>

	<br/>

		<h3><a name="Functions">Functions</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a href="#d634974eb95dab7b188c1f605747583a">serial_hw_read(byte out data) return bit</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#53a6c21cd59de67adb0fb30ceed24834">serial_hw_data'get() return byte</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#5a212ee47d076055884f40b9ab9fca90">serial_hw_data_raw'get() return byte</a></code></b>
		</li>
	</ul>



			<br/>
				<h2><a name="api">API details</a></h2>

		<h3><a name="Global variables/contants">Global variables/contants</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a name="e80cbd56e0db4e631e79e3a6e308cc49" href="#summary">var volatile bit serial_hw_data_available is PIR1_RCIF
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="eb6c35235eaf81d6929b69ba86d2a9b5" href="#summary">var volatile bit serial_hw_data_ready is PIR1_TXIF
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
	</ul>


		<h3><a name="Procedures">Procedures</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a name="9c4436d14f56c4adcbe5c8ed9df54543" href="#summary">serial_hw_data'put(byte in data)</a></code></b>
				<p>	<pre>Here Serial read and write are definied as pseudo variables
so you use them as normal vars, like
 * wait for character being received,
 * then echo the inverted character
{{{
serial_hw_data = ! serial_hw_data
}}}

these procedures will wait till they can perform their action
therefore it's better to use to following construct
{{{
 if charater received, echo the inverted character
if  serial_hw_data_available then
    serial_hw_data = ! serial_hw_data
end if
 do other things
}}}

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="c226cf7c88d829d242f6fa20db05aaa1" href="#summary">serial_hw_init()</a></code></b>
				<p>	<pre>Initializes the RS232 port, calculates baudrate registers.
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="7dae159ab02bbd43afeeb7ca142fc0bf" href="#summary">serial_hw_write_word(word in data)</a></code></b>
				<p>	<pre>like Serial_H_write, but then with a word as input
The MSB is outputed first
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="8bd2c619e16d85ae1bee277645842959" href="#summary">serial_hw_write(byte in data)</a></code></b>
				<p>	<pre>Asynchronuous RS232 send routine, using the TX pin
Sends byte X (8 bit with no parity) to the serial port
First checks (and waits if necessary) if transmit buffer is empty

remark: PIR1-register (containing _TXIF-flag) must be in bank0 !!
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="1a1121c18d13250b587ce73e505d0498" href="#summary">serial_hw_data_raw'put(byte in data)</a></code></b>
				<p>	<pre>These are real raw procedures, declared as pseudo variables
the user is totally responsible for testing the transmit/receive
flag before using these functions
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="264dd60fd05fd46f4277464c644c0a93" href="#summary">serial_hw_enable()</a></code></b>
				<p>	<pre>Enables USART (wether used as RS232 or SPI),
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="413f90937204bbfdb18553c6b6cd64e8" href="#summary">serial_hw_disable()</a></code></b>
				<p>	<pre>Disables USART (wether used as RS232 or SPI),
so ports can be used (temporary) for other purposes.
USART can be enabled again by calling serial_hw_enable()
</pre>
</p>
		</li>
	</ul>

	<i><small>Private</small></i>
		<ul>
		<li>
				<b><code name="code" class="python"><a name="fbc4399fa154b563eb2ae292bb279477" href="#summary">_calculate_and_set_baudrate()</a></code></b>
				<p>	<pre>internal function, calculates and sets baudrate divider
and stores it in the appropiate register.
the high-speed / low-speed bit is not stored but returned as the result

Special attention is payed to the highest and lowest baudrates,
a deviation of 5% is accepted in these cases

Asynchronous baudrate settings (see also page 74/75 of DS40300B):
{{{
if TXSTA_BRGH = 0 (low speed)
 SPBRG = ( Fosc / ( 64 * Baudrate ) ) -1

if TXSTA_BRGH = 1 (high speed)
 SPBRG = ( Fosc / ( 16 * Baudrate ) ) -1
}}}

Synchronous baudrate settings:
 * TXSTA_BRGH = 0 (low speed)
 * SPBRG = ( Fosc / ( 4 * Baudrate ) ) -1

</pre>
</p>
		</li>
	</ul>

	<br/>

		<h3><a name="Functions">Functions</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a name="d634974eb95dab7b188c1f605747583a" href="#summary">serial_hw_read(byte out data) return bit</a></code></b>
				<p>	<pre>Returns true if a character was received, otherwise returns false.
Overrun error flag is cleared.
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="53a6c21cd59de67adb0fb30ceed24834" href="#summary">serial_hw_data'get() return byte</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="5a212ee47d076055884f40b9ab9fca90" href="#summary">serial_hw_data_raw'get() return byte</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
	</ul>



			<br/>
				<h2><a name="related_samples">Related samples</a></h2>
	Here are the list of samples which use this library:<br/><br/>
	<table border=1>
			<tr>
			<td><b>16f648a</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/by_device/16f648a/16f648a_serial_hardware.jal" target="_blank">16f648a_serial_hardware.jal</a></td>
			</tr>
			<tr>
			<td><b>16f648a</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/by_device/16f648a/16f648a_serial_print.jal" target="_blank">16f648a_serial_print.jal</a></td>
			</tr>
			<tr>
			<td><b>16f648a</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/by_device/16f648a/16f648a_i2c_sw_l1.jal" target="_blank">16f648a_i2c_sw_l1.jal</a></td>
			</tr>
			<tr>
			<td><b>16f876a</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/by_device/16f876a/16f876a_t6603.jal" target="_blank">16f876a_t6603.jal</a></td>
			</tr>
			<tr>
			<td><b>16f877a</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/by_device/16f877a/16f877a_i2c_sw_l1.jal" target="_blank">16f877a_i2c_sw_l1.jal</a></td>
			</tr>
			<tr>
			<td><b>16f877a</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/by_device/16f877a/16f877a_co2_t6603.jal" target="_blank">16f877a_co2_t6603.jal</a></td>
			</tr>
			<tr>
			<td><b>16f877a</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/by_device/16f877a/16f877a_serial_hardware.jal" target="_blank">16f877a_serial_hardware.jal</a></td>
			</tr>
			<tr>
			<td><b>16f877a</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/by_device/16f877a/16f877a_i2c_hw_l1.jal" target="_blank">16f877a_i2c_hw_l1.jal</a></td>
			</tr>
			<tr>
			<td><b>16f877a</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/by_device/16f877a/16f877a_serial_format.jal" target="_blank">16f877a_serial_format.jal</a></td>
			</tr>
			<tr>
			<td><b>16f877a</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/by_device/16f877a/16f877a_print_serial_numbers.jal" target="_blank">16f877a_print_serial_numbers.jal</a></td>
			</tr>
			<tr>
			<td><b>16f877a</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/by_device/16f877a/16f877a_serial_print.jal" target="_blank">16f877a_serial_print.jal</a></td>
			</tr>
			<tr>
			<td><b>16f88</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/by_device/16f88/16f88_delay_basic.jal" target="_blank">16f88_delay_basic.jal</a></td>
			</tr>
			<tr>
			<td><b>16f88</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/by_device/16f88/16f88_serial_print.jal" target="_blank">16f88_serial_print.jal</a></td>
			</tr>
			<tr>
			<td><b>16f88</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/by_device/16f88/16f88_i2c_sw_l1.jal" target="_blank">16f88_i2c_sw_l1.jal</a></td>
			</tr>
			<tr>
			<td><b>16f88</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/by_device/16f88/16f88_remember_me.jal" target="_blank">16f88_remember_me.jal</a></td>
			</tr>
			<tr>
			<td><b>16f88</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/by_device/16f88/16f88_serial_hw_echo.jal" target="_blank">16f88_serial_hw_echo.jal</a></td>
			</tr>
			<tr>
			<td><b>16f88</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/by_device/16f88/16f88_adc_lowres.jal" target="_blank">16f88_adc_lowres.jal</a></td>
			</tr>
			<tr>
			<td><b>16f88</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/by_device/16f88/16f88_i2c_sw_master_echo.jal" target="_blank">16f88_i2c_sw_master_echo.jal</a></td>
			</tr>
			<tr>
			<td><b>16f88</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/by_device/16f88/16f88_print_serial_numbers.jal" target="_blank">16f88_print_serial_numbers.jal</a></td>
			</tr>
			<tr>
			<td><b>16f88</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/by_device/16f88/16f88_serial_format.jal" target="_blank">16f88_serial_format.jal</a></td>
			</tr>
			<tr>
			<td><b>16f88</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/by_device/16f88/16f88_serial_hardware.jal" target="_blank">16f88_serial_hardware.jal</a></td>
			</tr>
			<tr>
			<td><b>16f88</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/by_device/16f88/16f88_i2c_hw_slave_echo.jal" target="_blank">16f88_i2c_hw_slave_echo.jal</a></td>
			</tr>
	</table>

			<br/>

            </div>
        </div>


	</body>
</html>

