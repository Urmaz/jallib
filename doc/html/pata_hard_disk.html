<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
    <head>
		<title>pata_hard_disk - jallib API doc</title>
    </head>
    <body>
		
		        <div id="page">
        
            <div id="pagecontent">

			    
	<a href="#toc" name="pata_hard_disk">
    <h1>pata_hard_disk</h1>
	</a>

    <div>
		<font size="+1"><i>Hard disk library for communicating with parallel ata hard drives</i></font>
	</div>

	<br/>

    <div class="narrow">
        
	<table>
	<tr>
		<td style="border: 1px solid #aaa; padding: 5px;">
			<b>Author</b>
		</td>
		<td style="border: 1px solid #aaa; padding: 5px;">
			Matthew Schinkel - borntechi.com, copyright (c) 2009, all rights reserved.
		</td>
	</tr>
	<tr>
		<td style="border: 1px solid #aaa; padding: 5px;">
			<b>Adapted-by</b>
		</td>
		<td style="border: 1px solid #aaa; padding: 5px;">
			
		</td>
	</tr>
	<tr>
		<td style="border: 1px solid #aaa; padding: 5px;">
			<b>Compiler</b>
		</td>
		<td style="border: 1px solid #aaa; padding: 5px;">
			>=2.4k
		</td>
	</tr>
	</table>

	<br/>
	
	<b>Description</b>
	<p>
		<pre>this library provides functions for pata/ide hard disk drives.
</pre>

	</p>
	<br/>

	<b>Sources</b>
	<p>
		<pre>"connecting ide drives by tilmann reh" - http://www.gaby.de/gide/ide-tcj.txt
IDE hardware reference & information document by alex t. ivopol
ATA Attachement with Packet Interface 6 - d1410r3-ATA-ATAPI-6.pdf
</pre>

	</p>
	<br/>

	<b>Notes</b>
	<p>
		<pre>If you are not using Alternate Status, Digital Output or Drive Address registers
pins cs1 & cs0 can be saved by connecting these ide pins to cs0-high, cs1-low
</pre>

	</p>
	<br/>
	
	<b>Dependencies</b>
	<p>
		<i>No dependency found</i>
	</p>
	<br/>


			<br/>
				<h2><a name="summary">Summary</a></h2>

		<h3><a name="Global variables/contants">Global variables/contants</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a href="#32f8ed4fdb7b5fd110bad7ff5e4498b2">const PATA_HD_IDENTIFY_DRIVE = 0xEC  -- read drive info such as make/modem/sn/drive size
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#e6b361930b4699243db8b11d54724c40">const PATA_HD_WRITE_SECTOR = 0x30    -- write data to sector(s)
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#59b565913737eeda35f2798adfcbe4d1">const PATA_HD_CYL_HIGH_REG = 13   -- cylinder high
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#6a459bbc562f25d610a0f6e88635c55e">const PATA_HD_COMMAND_REG = 15    -- command register
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#9faeab9a9fc88b684c6c724351382fc6">const PATA_HD_DODC_REG = 16       -- digital output / device control
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#67153f334d25766a9565a4fc7335d4f2">const BIT PATA_HD_WAIT_WRITE = 1 -- wait for sector buffer to empty it's contents to disk platters
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#254549a4cfacc9a16cca9641a66b66bc">const PATA_HD_RECALIBRATE = 0x10     -- sends drive heads to cyl 0, SC, SN, and SDH are not changed
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#6ed5c50c40593d50e9aa30e00d53fd3d">const PATA_HD_SPIN_DOWN = 0xE0       -- turn off the drive's motor
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#a8787f38f0825c57a0bbf553edbd7efd">const PATA_HD_STATUS_REG = 15     -- status register
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#5bf8efdd51405150ca45417509f92bf5">const PATA_HD_READ_SECTOR = 0x20     -- reads data from sector(s)
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#6faadabf78460865742216400652433e">const PATA_HD_CYL_LOW_REG = 12    -- cylinder low
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#8032d38222ac8e7110e2ad6b167ed428">const PATA_HD_ADDRESS_REG = 17    -- drive address
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#cd1c6b664f9a2f8f590f5f1194068bd1">const PATA_HD_SEC_NUM_REG = 11    -- sector number
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#a13d1d39e250656b8c5f344786a6a180">const PATA_HD_ALT_STATUS_REG = 16 -- alternate status
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#1ec0d2bb73180b6997a1860000dd88e4">const PATA_HD_SPIN_UP = 0xE1         -- turn on the drive's motor
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#486b13ca4000846429e60f893ad06959">const PATA_HD_PRECOMP_REG = 9     -- write precomp reg
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#1f9613ab4f4ef3390997ed775f74a8ca">const PATA_HD_SEC_COUNT_REG = 10  -- sector count
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#5c84ee1230c20db41a2157365530fb2e">const BIT PATA_HD_WAIT_READ = 0  -- wait for sector buffer to fill it's contents with data from disk platters
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#394bbdfa8e53c2ae76726ce4996ddeab">const PATA_HD_ERROR_REG = 9       -- error register
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#0f6f7ec77d91458452480eb8c6079914">const PATA_HD_SDH_REG = 14        -- sector/drive/head register
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#428fa173fea0d6d78950c99649bec8d8">const PATA_HD_DATA_REG = 8        -- data register
</a></code></b>
		</li>
	</ul>


		<h3><a name="Procedures">Procedures</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a href="#0142f0b801ab367911b76a7916e6db10">pata_hd_go_to_sector(dword in sector, byte in sec_count)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#2cc026f524f9d2d1fcc6175e73b36906">pata_hd_write_pulse( byte in z )</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#f163bcee9e346e6fbe955f58eff9839d">pata_hd_data_request(bit in read_write)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#2f344287231345b00679035d0b7d02fb">pata_hd_read_data(byte out low_byte, byte out high_byte)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#36159ddfc4160d4737d38469489e5df2">pata_hd_register_write(byte in register, byte in low_byte)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#f5a33c6b73a007281b17e2afa09c1682">pata_hd_register_read(byte in register, byte out low_byte)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#9877b7b289008b18dc7ff2e32a875fac">pata_hd_select_register(byte in register)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#2b5471b150b490d8252c6adbb617d9e5">pata_hd_read_pulse(dword in z)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#c662dbd97469b20aea73b5920f8a8cd4">pata_hd_init()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#4b35bb2d479fd5c7cd29d344feaa88ea">pata_hd_set_address(byte in pata_hd_head_addr, byte in cyl_high_addr, byte in cyl_low_addr, byte in sec_num_addr, byte in sec_count)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#310fd9f31d7afe3e6c82428df9abd6ad">pata_hd_drive_ready()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#a4868bd93d9544f521f51c167e6dfb40">pata_hd_write_data(byte in low_byte, byte in high_byte)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#9ac9e981ffd431cc6c1243b187863799">pata_hd_busy()</a></code></b>
		</li>
	</ul>


		<h3><a name="Functions">Functions</a></h3>
		<ul>
	</ul>



			<br/>
				<h2><a name="api">API details</a></h2>

		<h3><a name="Global variables/contants">Global variables/contants</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a name="32f8ed4fdb7b5fd110bad7ff5e4498b2" href="#summary">const PATA_HD_IDENTIFY_DRIVE = 0xEC  -- read drive info such as make/modem/sn/drive size
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="e6b361930b4699243db8b11d54724c40" href="#summary">const PATA_HD_WRITE_SECTOR = 0x30    -- write data to sector(s)
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="59b565913737eeda35f2798adfcbe4d1" href="#summary">const PATA_HD_CYL_HIGH_REG = 13   -- cylinder high
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="6a459bbc562f25d610a0f6e88635c55e" href="#summary">const PATA_HD_COMMAND_REG = 15    -- command register
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="9faeab9a9fc88b684c6c724351382fc6" href="#summary">const PATA_HD_DODC_REG = 16       -- digital output / device control
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="67153f334d25766a9565a4fc7335d4f2" href="#summary">const BIT PATA_HD_WAIT_WRITE = 1 -- wait for sector buffer to empty it's contents to disk platters
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="254549a4cfacc9a16cca9641a66b66bc" href="#summary">const PATA_HD_RECALIBRATE = 0x10     -- sends drive heads to cyl 0, SC, SN, and SDH are not changed
</a></code></b>
				<p>	<pre>common commands for command register:
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="6ed5c50c40593d50e9aa30e00d53fd3d" href="#summary">const PATA_HD_SPIN_DOWN = 0xE0       -- turn off the drive's motor
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="a8787f38f0825c57a0bbf553edbd7efd" href="#summary">const PATA_HD_STATUS_REG = 15     -- status register
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="5bf8efdd51405150ca45417509f92bf5" href="#summary">const PATA_HD_READ_SECTOR = 0x20     -- reads data from sector(s)
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="6faadabf78460865742216400652433e" href="#summary">const PATA_HD_CYL_LOW_REG = 12    -- cylinder low
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="8032d38222ac8e7110e2ad6b167ed428" href="#summary">const PATA_HD_ADDRESS_REG = 17    -- drive address
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="cd1c6b664f9a2f8f590f5f1194068bd1" href="#summary">const PATA_HD_SEC_NUM_REG = 11    -- sector number
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="a13d1d39e250656b8c5f344786a6a180" href="#summary">const PATA_HD_ALT_STATUS_REG = 16 -- alternate status
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="1ec0d2bb73180b6997a1860000dd88e4" href="#summary">const PATA_HD_SPIN_UP = 0xE1         -- turn on the drive's motor
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="486b13ca4000846429e60f893ad06959" href="#summary">const PATA_HD_PRECOMP_REG = 9     -- write precomp reg
</a></code></b>
				<p>	<pre>writeable registers
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="1f9613ab4f4ef3390997ed775f74a8ca" href="#summary">const PATA_HD_SEC_COUNT_REG = 10  -- sector count
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="5c84ee1230c20db41a2157365530fb2e" href="#summary">const BIT PATA_HD_WAIT_READ = 0  -- wait for sector buffer to fill it's contents with data from disk platters
</a></code></b>
				<p>	<pre>other constants
used for pata_hd_data_request()
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="394bbdfa8e53c2ae76726ce4996ddeab" href="#summary">const PATA_HD_ERROR_REG = 9       -- error register
</a></code></b>
				<p>	<pre>readable registers
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="0f6f7ec77d91458452480eb8c6079914" href="#summary">const PATA_HD_SDH_REG = 14        -- sector/drive/head register
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="428fa173fea0d6d78950c99649bec8d8" href="#summary">const PATA_HD_DATA_REG = 8        -- data register
</a></code></b>
				<p>	<pre>readable/writeable registers
</pre>
</p>
		</li>
	</ul>


		<h3><a name="Procedures">Procedures</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a name="0142f0b801ab367911b76a7916e6db10" href="#summary">pata_hd_go_to_sector(dword in sector, byte in sec_count)</a></code></b>
				<p>	<pre>
Go to a specific sector number (lba mode only)
Max sector number is 268435455 or the number of sectors the drive has.
Max drive size is 268435455 * 512 = 137.439 GB
Sector count selects number of sectors that will be read
Sector count value of 0 means 256 sectors will be read

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="2cc026f524f9d2d1fcc6175e73b36906" href="#summary">pata_hd_write_pulse( byte in z )</a></code></b>
				<p>	<pre>
Send a number of write pulses to data register sending 0's as data.
Used to get to the end of a sector or to get to a certain
location in a sector.
Increment pata_hd_word_count

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="f163bcee9e346e6fbe955f58eff9839d" href="#summary">pata_hd_data_request(bit in read_write)</a></code></b>
				<p>	<pre>
Wait for drive to be ready for a data transfer.
Sets data pins as inputs or outputs for next read or write.

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="2f344287231345b00679035d0b7d02fb" href="#summary">pata_hd_read_data(byte out low_byte, byte out high_byte)</a></code></b>
				<p>	<pre>
Read two bytes from disk.
must use pata_hd_data_request(PATA_HD_WAIT_READ) before each 256 reads
(before reading each sector)

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="36159ddfc4160d4737d38469489e5df2" href="#summary">pata_hd_register_write(byte in register, byte in low_byte)</a></code></b>
				<p>	<pre>
Select a register and give it a command or data.

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="f5a33c6b73a007281b17e2afa09c1682" href="#summary">pata_hd_register_read(byte in register, byte out low_byte)</a></code></b>
				<p>	<pre>
Select a register and get data from it.

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="9877b7b289008b18dc7ff2e32a875fac" href="#summary">pata_hd_select_register(byte in register)</a></code></b>
				<p>	<pre>
Set register select pins to selected register, for internal use only.

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="2b5471b150b490d8252c6adbb617d9e5" href="#summary">pata_hd_read_pulse(dword in z)</a></code></b>
				<p>	<pre>
Send a number of read pulses to data register without getting any data.
Used to get to the end of a sector or to get to a certain
location in a sector.
Increment pata_hd_word_count

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="c662dbd97469b20aea73b5920f8a8cd4" href="#summary">pata_hd_init()</a></code></b>
				<p>	<pre>
initialize startup settings

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="4b35bb2d479fd5c7cd29d344feaa88ea" href="#summary">pata_hd_set_address(byte in pata_hd_head_addr, byte in cyl_high_addr, byte in cyl_low_addr, byte in sec_num_addr, byte in sec_count)</a></code></b>
				<p>	<pre>
Go to a specific sector, select lba/chs mode and master/slave drive
Max sector number is 0x0F_FF_FF_FF or the number of sectors the drive has.
Max drive size is 0x0F_FF_FF_FF * 512 = 137.439 GB
Sector count selects number of sectors that will be read
Sector count value of 0 means 256 sectors will be read

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="310fd9f31d7afe3e6c82428df9abd6ad" href="#summary">pata_hd_drive_ready()</a></code></b>
				<p>	<pre>
Wait for drive to be up to speed and ready for a command.

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="a4868bd93d9544f521f51c167e6dfb40" href="#summary">pata_hd_write_data(byte in low_byte, byte in high_byte)</a></code></b>
				<p>	<pre>
Write two bytes to disk
must use pata_hd_data_request(PATA_HD_WAIT_WRITE) before each 256 writes
(before writing each sector)
Data will not be written unless 256 writes are sent.

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="9ac9e981ffd431cc6c1243b187863799" href="#summary">pata_hd_busy()</a></code></b>
				<p>	<pre>
Registers may not be accessed unless bsy bit is
low due to internal operations.

</pre>
</p>
		</li>
	</ul>


		<h3><a name="Functions">Functions</a></h3>
		<ul>
	</ul>



			<br/>
				<h2><a name="related_samples">Related samples</a></h2>
	Here are the list of samples which use this library:<br/><br/>
	<table border=1>
			<tr>
			<td><b>16f877</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/16f877_pata_hard_disk.jal" target="_blank">16f877_pata_hard_disk.jal</a></td>
			</tr>
	</table>

			<br/>

            </div>
        </div>


	</body>
</html>

