<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
    <head>
    		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
		<title>usb_msd - jallib API doc</title>
    </head>
    <body>
		
		        <div id="page">
        
            <div id="pagecontent">

			    
	<a href="#toc" name="usb_msd">
    <h1>usb_msd</h1>
	</a>

    <div>
		<font size="+1"><i>USB Mass Storage Device</i></font>
	</div>

	<br/>

    <div class="narrow">
        
	<table>
	<tr>
		<td style="border: 1px solid #aaa; padding: 5px;">
			<b>Author</b>
		</td>
		<td style="border: 1px solid #aaa; padding: 5px;">
			Matthew Schinkel - borntechi.com, copyright &copy; 2009, all rights reserved.
		</td>
	</tr>
	<tr>
		<td style="border: 1px solid #aaa; padding: 5px;">
			<b>Adapted-by</b>
		</td>
		<td style="border: 1px solid #aaa; padding: 5px;">
			
		</td>
	</tr>
	<tr>
		<td style="border: 1px solid #aaa; padding: 5px;">
			<b>Compiler</b>
		</td>
		<td style="border: 1px solid #aaa; padding: 5px;">
			>=2.4o
		</td>
	</tr>
	</table>

	<br/>
	
	<b>Description</b>
	<p>
		<pre>Library for USB MSD (Mass Storage Device) with SD card,
             hard disk, or jallib supported storage device.
</pre>

	</p>
	<br/>

	<b>Sources</b>
	<p>
		<pre>http://www.usb.org/developers/devclass_docs/usbmassbulk_10.pdf
http://www.usb.org/developers/devclass_docs/usbmass-ufi10.pdf
http://direction.scene-double.com/2008/07/08/usb-msd-bootloader-for-pic-microcontrollers.aspx
</pre>

	</p>
	<br/>

	
	<b>Dependencies</b>
	<p>
		<ul>
			<li><a href="usb_drv.html">usb_drv</a></li>
			<li><a href="usb_defs.html">usb_defs</a></li>
			<li><a href="usb_drv_core.html">usb_drv_core</a></li>
		</ul>


			<br/>
				<h2><a name="summary">Summary</a></h2>

		<h3><a name="Global variables/contants">Global variables/contants</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a href="#016376164a996afdeafcd16cddb65277">var bit*7 usb_msd_sense_response_code at usb_msd_sense_response_valid : 0 </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#1ff43351437509acf6bf2974b0ed9d46">var bit usb_msd_sense_filemark  at usb_msd_sense_filemark_eom_ili_reserved_key : 7</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#b5c7652133a24e06b58f14cf478e32a8">const byte USB_STRING2_SIZE = 0x34</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#03dcd93b712b769715e29b5c2122f273">const byte USB_MSD_SENSE_ASC_READ_ERROR                   = 0x11</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#a114973b56ddcca358d134b85fc6ed4e">const bit USB_EP0 = ENABLED</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#44427540fa006857848303514b3dc17d">var byte _usb_msd_address[4] at usb_msd_address</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#92c2b83abcda517cb0ef12dab8c34a54">const byte USB_STRING3_SIZE = 0x1A</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#22b292fb2b718f57696098bd4fb0e509">var byte _usb_msd_csw_signature[4] at usb_msd_csw_signature</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#139f81f52284aeac81b5b9ecca537227">const byte USB_MSD_READ_CAPACITY                 = 0x25</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#d43cd8a0c3f809a3b093bd2252ad6e0d">var byte usb_msd_sense_add_sense_len</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#3e9a27d32676ac16b3815dce5e616373">var volatile bit usb_msd_sae_owns_bit_in at usb_bd1in_stat : USB_BDSTATUS_UOWN</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#7dd396a232e0f374408e8bbd6de57f9f">var bit usb_msd_sense_reserved  at usb_msd_sense_filemark_eom_ili_reserved_key : 4</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#e52832ebb30e1d7f75760ebedc64d3f7">const byte USB_MSD_WRITE_10                      = 0x2a</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#9c9370bc5101773d84bb4ecf5986a029">const byte USB_MSD_SENSE_ASC_LOGICAL_BLOCK_OUT_OF_RANGE   = 0x21</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#24e8e8c37073820589fa0d4b63c67556">var volatile byte msd_tx_buffer[USB_EP1_IN_SIZE]; at USB_EP1_IN_ADDR</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#5d932859e3590cc4067b8364bf35e6a9">const byte USB_MSD_SENSE_ILLEGAL_REQUEST                  = 0x05</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#6b75960a75e29039e78cfed3bc79795d">const byte USB_MSD_SENSE_NOT_READY                        = 0x02</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#a8771c0aa7afff3fa1dce2ca77532cb1">var byte usb_msd_sense_key_specific[3]</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#c7f0baf27e36d4cb8ee370454ebf0a03">const byte USB_MSD_INQUIRY                       = 0x12</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#6b1dd33eaba3db14cb436d6237e572ec">const bit USB_EP1 = ENABLED</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#7bdd40e65d0d59a45bb4b50544cd0112">var dword usb_msd_address</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#3b7a33c3eb38caac9bf4fe0f219137ca">var bit usb_msd_sense_key_specific_sksv at usb_msd_sense_key_specific[0] : 7</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#dd8edd8c07fb3fb7aa13a8fd5be6f687">var byte _usb_msd_cbw_tag[4] at usb_msd_cbw_tag</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#12edad43e056b7bba2a86f91bebf578e">var byte usb_msd_sense_response_valid</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#06ced63e8e33d69205dc5af28bbf9c5f">const byte USB_EP0_IN_SIZE  = 64</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#7f02e613d3a14b6aa13267f5442cb202">var byte _usb_msd_cbw_command[16] at usb_msd_cbw_command</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#7ee739918c5c34c780def699ca21bb3c">const byte USB_MSD_MODE_SENSE                    = 0x1a</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#6d5181739906e235506b0c7b48bed61a">const byte USB_EP0_OUT_SIZE = 64</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#3a063e561f7c710ed7fda72fcc1efd90">const byte USB_MSD_READ_FORMAT_CAPACITY          = 0x23</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#571d36595065023717971d54360b228e">const USB_MSD_STATE_DATA_IN   = 1   </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#b0beaa6aef8d42d8478fc3eb2839aab1">var byte _usb_msd_num_of_blocks[4] at usb_msd_num_of_blocks</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#7960eb88969ed61e21d8a16f2c734aab">const byte USB_STRING1_SIZE = 0x34</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#d6c88c89a7228fdd10e1d30a54eea2de">const byte USB_MSD_PREVENT_ALLOW_MEDIUM_REMOVAL  = 0x1e</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#4756d1f57e75f821daa8e019f24a2dcd">const byte USB_MSD_SENSE_ASCQ_DEVICE_WRITE_FAULT          = 0x00</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#5cbe555b6416320b1fd8f534c226175d">const byte USB_CONFIGURATION_DESCRIPTOR[USB_CONFIGURATION_DESCRIPTOR_SIZE] =</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#65b3be0e56ecdc610b09933e0bb19c4a">var byte usb_msd_sense_ascq</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#360b6840095b914b15180dfb2c0ebcfd">const byte USB_MSD_REQUEST_SENSE                 = 0x03</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#c4ae870b081146fadf186f6c731166e3">var volatile byte usb_ep1out_buf[USB_EP1_OUT_SIZE] at USB_EP1_OUT_ADDR</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#6f902657ee1d67312275e1b344a713d5">const dword USB_MSD_CBW = 0x43425355      </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#d8c6978ac0d86d460f95fc7fc2ff5ad6">var dword usb_msd_data_residue = 0</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#c85bcb2d29e8b1070d89ad4bed0d31db">var volatile byte usb_msd_cbw_cbw_lun = 0 </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#fe507d89d99abf7ae55c93afcbc8fa8e">const byte USB_EP1_IN_SIZE  = 64</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#6f7629a537395dbd471b71c67df75737">var byte usb_msd_csw_status = 0          </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#4ad8d7c181c7eb7a7e9c542ce1ca5148">const USB_HOST_DIRECTION_SEND = FALSE</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#a3eba443e838e892d40ff1649a0c0e33">const byte USB_MSD_READ_10                       = 0x28</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#0633e87860c360e3f9832eacc03eaed4">var byte usb_msd_sense_asc</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#a3f21605bf7c5bb11ef8343da6512289">var volatile byte usb_msd_cbw_length = 0  </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#3c5c78189f04e79059094181059bb354">var bit usb_msd_sense_valid at usb_msd_sense_response_code : 7 </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#3db1ca1b9faec8e2b36ffbbb2994dfe6">var byte usb_msd_sense_fruc</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#0d79a3a963f54c31023599cbbeb47a16">var byte usb_msd_sense_obsolete</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#3b1e9c387da658005e377f8b9f6086b6">var volatile bit usb_msd_sae_owns_bit_out at usb_bd1out_stat : USB_BDSTATUS_UOWN</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#f3f97fe79b588f862a8cdd314d33170c">const USB_MSD_CSW_STATUS_FAIL = 0x01     </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#67b6f8e46dcdbf7cd1ecc48589abdb32">const bit USB_EP3 = DISABLED</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#98d5ccba130a98ab140a32a3f9997231">const byte USB_MSD_SENSE_ASCQ_INVALID_COMMAND_OPCODE      = 0x00</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#1359c3abd8fa6d753b312d7336e0ee88">var volatile byte msd_tx_test_buffer[USB_EP1_IN_SIZE] at USB_EP1_IN_ADDR</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#76174991ff2c5c1e1672993b35afd4be">var dword usb_msd_cbw_signature = 0       </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#e51c162a9e3eb96dfdad22d1001575bb">var byte _usb_msd_cbw_signature[4] at usb_msd_cbw_signature</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#3733e0bdb469ee96d11d363e4fd46920">const USB_MSD_STATE_DATA_OUT  = 2   </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#e13971347422026e74592a74f85bc80c">const word USB_EP0_OUT_ADDR = (USB_BASE_ADDRESS + 0x0010)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#928722a61687b8954c1f6a8fa3df94fc">const byte USB_MSD_SENSE_MEDIUM_ERROR                     = 0x03</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#6378e9dffe92e3527bf83677c69ea84a">var volatile byte usb_msd_cbw_flags = 0   </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#9b02960eac4e4d4d8ca7fb5210d240d6">var dword usb_msd_cbw_tag = 0             </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#f09c5517bc07c80e9076e8d896df9e65">const word USB_EP1_IN_ADDR  = (0x0500)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#5e2f3e99f51f154f271e74687beeb129">var dword usb_msd_sense_command_spacific</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#2d064e3a697333ff51ac72ddec991bb6">const byte USB_MSD_VERIFY                        = 0x2f</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#4fcd311eed06d3fe466c426a90aab290">var byte _usb_msd_csw_tag[4] at usb_msd_cbw_tag</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#40ca1521aec2fd33baf3eac7fdc8e725">var dword usb_msd_csw_signature = 0 </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#4994fdcd1c95d9fbad0a80029bf634d6">const USB_MSD_CSW_STATUS_SUCCESS = 0x00  </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#edf854794c36a3f3d846243bca226b9e">const byte USB_MSD_SENSE_ASCQ_WRITE_PROTECTED             = 0x00</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#8b27eecc7c12f43bdbd951f230f17245">const USB_CONFIGURATION_DESCRIPTOR_SIZE = 0x09 + 0x09 + 0x07 + 0x07</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#d348170b021d8b85b2f9a41cf5c0cf7f">const byte USB_MSD_TEST_UNIT_READY               = 0x00</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#f100e88e869eca4dfd79e9d1d5a3bb58">var dword usb_msd_csw_tag = 0</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#520f3d85a3be89ff1c3728cc8dfc1991">var volatile byte reserve_array[0x10] at 0x400 + 256</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#6d666fde180a59de8feaf851bc21e82f">const word USB_EP0_IN_ADDR  = (USB_EP0_OUT_ADDR + USB_EP0_OUT_SIZE )</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#3d9b672ee766b6747f1b7282ee8d1891">const byte USB_MSD_SENSE_ASCQ_MEDIUM_NOT_PRESENT          = 0x00</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#ae7e03f76e789f5216f912067558e3ea">const byte USB_MSD_SENSE_ASC_INVALID_COMMAND_OPCODE       = 0x20</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#78af67d483b66f7370af9e2ac0b07673">var byte _usb_msd_sense_command_spacific[4] at usb_msd_sense_command_spacific</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#9493f411c0e91666f332578c77675a15">var bit usb_msd_sense_ili       at usb_msd_sense_filemark_eom_ili_reserved_key : 5</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#f7ea4c347f4a317f51214997ca3d450d">const byte USB_MSD_SENSE_UNIT_ATTENTION                   = 0x06</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#0218058a8f32297a0286ab7da18b64cf">const byte USB_MSD_SENSE_ASCQ_READ_ERROR                  = 0x00</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#298e4e960518498de15f01ebeac3c48c">const byte USB_STRING2[USB_STRING2_SIZE] =</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#1b1993ad50d4d762065a02b6432ee637">const USB_MSD_CSW = 0x53425355      </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#abf722eb33a18184b619d615c0b1b3c4">var bit usb_host_direction at usb_msd_cbw_flags : 7 </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#b4f2fdb41ae2ff012b3b30b7d57b2798">var word _usb_msd_step64 = 0</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#4db6e561efe29531f88430486831b5fb">var byte _usb_msd_sense_information[4] at usb_msd_sense_information</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#cb747f5582d88a083224be0c9964396b">var byte _usb_msd_data_residue[4] at usb_msd_data_residue</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#ef2b16f8e9113e628b67d9da0ac24365">const word USB_EP1_OUT_ADDR = (USB_EP0_IN_ADDR + USB_EP0_IN_SIZE)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#528e1ed7461533e1ae8427e419e1918f">const byte USB_MSD_STOP_START                    = 0x1b</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#ca25b21349f66b70226ef27ccdb94e7b">const byte USB_EP1_OUT_SIZE = 64</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#38b4effbd21c4fe8b0207ab0fdf7bd1e">const byte USB_MSD_SENSE_ASCQ_LOGICAL_BLOCK_OUT_OF_RANGE  = 0x00</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#b4176cb10db2a420674e97f58547f73e">var dword usb_msd_cbw_data_transfer_length = 0 </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#f89039b5b2b915bec9867ef31ec7e659">const byte USB_DEVICE_DESCRIPTOR[USB_DEVICE_DESCRIPTOR_SIZE] =</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#c9d59aa17e5e5df4ca3a029ca212b0fe">var byte _usb_msd_block_size[4] at usb_msd_block_size</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#7af4c970934fc94148a092188a23afb8">var volatile byte usb_ep1in_buf[USB_EP1_IN_SIZE] at USB_EP1_IN_ADDR</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#6d43718deb635d7ff27f46783a3035a3">const byte USB_STRING3[USB_STRING3_SIZE] =</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#93999536c287f4cb04d19e007abf18b0">const byte USB_STRING0[] =</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#43e095c34b523179ed7b9ab7c4d645d4">const bit USB_EP2 = DISABLED</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#303a39f3c87de9f0d6f0ce01666955f0">const USB_MSD_STATE_WAIT      = 0   </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#e0bf24f59201a0f539ad2bff6aa281a3">var byte*16 usb_msd_cbw_command = 0       </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#41c104e461f50ebb03c150f9c33bcbcc">var dword _usb_msd_sector_step</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#b7408e6c4e27778a832376927bfe3805">const USB_HOST_DIRECTION_RECEIVE = TRUE</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#dacaa454456c0494e8e00073b896d442">var byte usb_msd_temp at 0x400 + 255</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#1764d1e2fdae0c3e595b37e4446ae216">const byte USB_MSD_SENSE_ASC_MEDIUM_NOT_PRESENT           = 0x3A</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#4fbf4a75a2e3392a1479141fad1c2e37">var bit*4 usb_msd_sense_key     at usb_msd_sense_filemark_eom_ili_reserved_key : 0</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#781bf4bf80611d5c6000b89e01706e65">var byte usb_msd_sense_filemark_eom_ili_reserved_key</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#51e1b453a6dd65dee20d612d9ce26528">const byte USB_MSD_SENSE_ASC_WRITE_PROTECTED              = 0x27</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#0e455db21d8f20144b2d84ce3e4253d3">var bit usb_msd_sense_eom       at usb_msd_sense_filemark_eom_ili_reserved_key : 6</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#bae8f460eb801cfbf91f7e14c618256c">var dword usb_msd_sense_information</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#3f8ff7092633a2f0ff627da5ffc3f5a7">var byte _usb_msd_cbw_data_transfer_length[4] at usb_msd_cbw_data_transfer_length</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#9c6e32cb57c0d5f7b567c81f11867442">var byte usb_msd_state  = USB_MSD_STATE_WAIT</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#efd0372f34ecbd54353d5a98c75aa544">const byte USB_MSD_SENSE_ASC_DEVICE_WRITE_FAULT           = 0x03</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#e5e43a20fb8f2abc020c3ff3a9fe59c2">const byte USB_STRING1[USB_STRING1_SIZE] =</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#d9bd64a31606020e57c8270f66078957">var byte _usb_msd_step_byte = 0</a></code></b>
		</li>
	</ul>


		<h3><a name="Procedures">Procedures</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a href="#b2bda27169e63b6e4d7dcd487b1df262">usb_msd_wait_configured()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#8c612b9e2f1a9c7fa52379a5c99b184f">usb_msd_reset_sense_data()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#26c043dd07cc5d50f99833052c5fb800">usb_ep_data_out_callback(byte in end_point, word in buffer_addr, byte in byte_count)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#53e8d5e5c975b3b41bbafab71695b428">usb_msd_init()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#9c7c2d10d3ff82b3edef0b4b0b31641c">msd_send_data(byte in size, bit in do_copy, bit in wait_own)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#745a8f83db9d3fc096870cf68cdc4319">msd_wait_own_tx()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#cb5231cab1ade54cebf58ea5e5653fc5">usb_ep_data_in_callback(byte in end_point, word in buffer_addr, byte in byte_count)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#23430b71941e0f5e25b74a8da9796830">usb_msd_tasks()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#66922fe39db49ec3a1b28ff8e2ec34ec">msd_wait_own_rx()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#75ed96f5e001fe5e243bed309816b479">usb_send_csw()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#54b2020647b644cf6d8d6abd992a3e98">usb_reset_callback()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#fa8375b23bb683a18973b8efdf73709f">usb_msd_command_received()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#cd9fda30b2d7d106c7c716165b971168">usb_msd_process_data()</a></code></b>
		</li>
	</ul>


		<h3><a name="Functions">Functions</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a href="#4b58b0f09f00e58e3ae299ea91121c93">msd_cbw_is_valid() return bit</a></code></b>
		</li>
	</ul>



			<br/>
				<h2><a name="api">API details</a></h2>

		<h3><a name="Global variables/contants">Global variables/contants</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a name="016376164a996afdeafcd16cddb65277" href="#summary">var bit*7 usb_msd_sense_response_code at usb_msd_sense_response_valid : 0 </a></code></b>
				<p>	<pre>bits 0..6</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="1ff43351437509acf6bf2974b0ed9d46" href="#summary">var bit usb_msd_sense_filemark  at usb_msd_sense_filemark_eom_ili_reserved_key : 7</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="b5c7652133a24e06b58f14cf478e32a8" href="#summary">const byte USB_STRING2_SIZE = 0x34</a></code></b>
				<p>	<pre>String descriptor describing this product
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="03dcd93b712b769715e29b5c2122f273" href="#summary">const byte USB_MSD_SENSE_ASC_READ_ERROR                   = 0x11</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="a114973b56ddcca358d134b85fc6ed4e" href="#summary">const bit USB_EP0 = ENABLED</a></code></b>
				<p>	<pre>
Setup USB endpoints, endpoint 0 and 1 are required for a MSD class

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="44427540fa006857848303514b3dc17d" href="#summary">var byte _usb_msd_address[4] at usb_msd_address</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="92c2b83abcda517cb0ef12dab8c34a54" href="#summary">const byte USB_STRING3_SIZE = 0x1A</a></code></b>
				<p>	<pre>String descriptor describing the device serial number
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="22b292fb2b718f57696098bd4fb0e509" href="#summary">var byte _usb_msd_csw_signature[4] at usb_msd_csw_signature</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="139f81f52284aeac81b5b9ecca537227" href="#summary">const byte USB_MSD_READ_CAPACITY                 = 0x25</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="d43cd8a0c3f809a3b093bd2252ad6e0d" href="#summary">var byte usb_msd_sense_add_sense_len</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="3e9a27d32676ac16b3815dce5e616373" href="#summary">var volatile bit usb_msd_sae_owns_bit_in at usb_bd1in_stat : USB_BDSTATUS_UOWN</a></code></b>
				<p>	<pre>UOWN bit
When SAE owns, we cannot use the endpoint. SAE is the usb module or  output interface.
When CPU owns, we can use the endpoint to write or send data.
We must give ownership back to SAE when we're done with it.
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="7dd396a232e0f374408e8bbd6de57f9f" href="#summary">var bit usb_msd_sense_reserved  at usb_msd_sense_filemark_eom_ili_reserved_key : 4</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="e52832ebb30e1d7f75760ebedc64d3f7" href="#summary">const byte USB_MSD_WRITE_10                      = 0x2a</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="9c9370bc5101773d84bb4ecf5986a029" href="#summary">const byte USB_MSD_SENSE_ASC_LOGICAL_BLOCK_OUT_OF_RANGE   = 0x21</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="24e8e8c37073820589fa0d4b63c67556" href="#summary">var volatile byte msd_tx_buffer[USB_EP1_IN_SIZE]; at USB_EP1_IN_ADDR</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="5d932859e3590cc4067b8364bf35e6a9" href="#summary">const byte USB_MSD_SENSE_ILLEGAL_REQUEST                  = 0x05</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="6b75960a75e29039e78cfed3bc79795d" href="#summary">const byte USB_MSD_SENSE_NOT_READY                        = 0x02</a></code></b>
				<p>	<pre>sense codes
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="a8771c0aa7afff3fa1dce2ca77532cb1" href="#summary">var byte usb_msd_sense_key_specific[3]</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="c7f0baf27e36d4cb8ee370454ebf0a03" href="#summary">const byte USB_MSD_INQUIRY                       = 0x12</a></code></b>
				<p>	<pre>MSD commands we may get from host
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="6b1dd33eaba3db14cb436d6237e572ec" href="#summary">const bit USB_EP1 = ENABLED</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="7bdd40e65d0d59a45bb4b50544cd0112" href="#summary">var dword usb_msd_address</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="3b7a33c3eb38caac9bf4fe0f219137ca" href="#summary">var bit usb_msd_sense_key_specific_sksv at usb_msd_sense_key_specific[0] : 7</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="dd8edd8c07fb3fb7aa13a8fd5be6f687" href="#summary">var byte _usb_msd_cbw_tag[4] at usb_msd_cbw_tag</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="12edad43e056b7bba2a86f91bebf578e" href="#summary">var byte usb_msd_sense_response_valid</a></code></b>
				<p>	<pre>Request Sense variables
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="06ced63e8e33d69205dc5af28bbf9c5f" href="#summary">const byte USB_EP0_IN_SIZE  = 64</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="7f02e613d3a14b6aa13267f5442cb202" href="#summary">var byte _usb_msd_cbw_command[16] at usb_msd_cbw_command</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="7ee739918c5c34c780def699ca21bb3c" href="#summary">const byte USB_MSD_MODE_SENSE                    = 0x1a</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="6d5181739906e235506b0c7b48bed61a" href="#summary">const byte USB_EP0_OUT_SIZE = 64</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="3a063e561f7c710ed7fda72fcc1efd90" href="#summary">const byte USB_MSD_READ_FORMAT_CAPACITY          = 0x23</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="571d36595065023717971d54360b228e" href="#summary">const USB_MSD_STATE_DATA_IN   = 1   </a></code></b>
				<p>	<pre>data in state (time for device to send data to host)</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="b0beaa6aef8d42d8478fc3eb2839aab1" href="#summary">var byte _usb_msd_num_of_blocks[4] at usb_msd_num_of_blocks</a></code></b>
				<p>	<pre>size of the storage device
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="7960eb88969ed61e21d8a16f2c734aab" href="#summary">const byte USB_STRING1_SIZE = 0x34</a></code></b>
				<p>	<pre>String descriptor describing the manufacturer
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="d6c88c89a7228fdd10e1d30a54eea2de" href="#summary">const byte USB_MSD_PREVENT_ALLOW_MEDIUM_REMOVAL  = 0x1e</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="4756d1f57e75f821daa8e019f24a2dcd" href="#summary">const byte USB_MSD_SENSE_ASCQ_DEVICE_WRITE_FAULT          = 0x00</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="5cbe555b6416320b1fd8f534c226175d" href="#summary">const byte USB_CONFIGURATION_DESCRIPTOR[USB_CONFIGURATION_DESCRIPTOR_SIZE] =</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="65b3be0e56ecdc610b09933e0bb19c4a" href="#summary">var byte usb_msd_sense_ascq</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="360b6840095b914b15180dfb2c0ebcfd" href="#summary">const byte USB_MSD_REQUEST_SENSE                 = 0x03</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="c4ae870b081146fadf186f6c731166e3" href="#summary">var volatile byte usb_ep1out_buf[USB_EP1_OUT_SIZE] at USB_EP1_OUT_ADDR</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="6f902657ee1d67312275e1b344a713d5" href="#summary">const dword USB_MSD_CBW = 0x43425355      </a></code></b>
				<p>	<pre>CBW variables
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="d8c6978ac0d86d460f95fc7fc2ff5ad6" href="#summary">var dword usb_msd_data_residue = 0</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="c85bcb2d29e8b1070d89ad4bed0d31db" href="#summary">var volatile byte usb_msd_cbw_cbw_lun = 0 </a></code></b>
				<p>	<pre>must be volatile otherwise compiler throws it away</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="fe507d89d99abf7ae55c93afcbc8fa8e" href="#summary">const byte USB_EP1_IN_SIZE  = 64</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="6f7629a537395dbd471b71c67df75737" href="#summary">var byte usb_msd_csw_status = 0          </a></code></b>
				<p>	<pre>status of the command excecuted</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="4ad8d7c181c7eb7a7e9c542ce1ca5148" href="#summary">const USB_HOST_DIRECTION_SEND = FALSE</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="a3eba443e838e892d40ff1649a0c0e33" href="#summary">const byte USB_MSD_READ_10                       = 0x28</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="0633e87860c360e3f9832eacc03eaed4" href="#summary">var byte usb_msd_sense_asc</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="a3f21605bf7c5bb11ef8343da6512289" href="#summary">var volatile byte usb_msd_cbw_length = 0  </a></code></b>
				<p>	<pre>must be volatile otherwise compiler throws it away</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="3c5c78189f04e79059094181059bb354" href="#summary">var bit usb_msd_sense_valid at usb_msd_sense_response_code : 7 </a></code></b>
				<p>	<pre>bit 7</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="3db1ca1b9faec8e2b36ffbbb2994dfe6" href="#summary">var byte usb_msd_sense_fruc</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="0d79a3a963f54c31023599cbbeb47a16" href="#summary">var byte usb_msd_sense_obsolete</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="3b1e9c387da658005e377f8b9f6086b6" href="#summary">var volatile bit usb_msd_sae_owns_bit_out at usb_bd1out_stat : USB_BDSTATUS_UOWN</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="f3f97fe79b588f862a8cdd314d33170c" href="#summary">const USB_MSD_CSW_STATUS_FAIL = 0x01     </a></code></b>
				<p>	<pre>status values for usb_msd_csw_status
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="67b6f8e46dcdbf7cd1ecc48589abdb32" href="#summary">const bit USB_EP3 = DISABLED</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="98d5ccba130a98ab140a32a3f9997231" href="#summary">const byte USB_MSD_SENSE_ASCQ_INVALID_COMMAND_OPCODE      = 0x00</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="1359c3abd8fa6d753b312d7336e0ee88" href="#summary">var volatile byte msd_tx_test_buffer[USB_EP1_IN_SIZE] at USB_EP1_IN_ADDR</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="76174991ff2c5c1e1672993b35afd4be" href="#summary">var dword usb_msd_cbw_signature = 0       </a></code></b>
				<p>	<pre>variable to receive a CBW signature before checking</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="e51c162a9e3eb96dfdad22d1001575bb" href="#summary">var byte _usb_msd_cbw_signature[4] at usb_msd_cbw_signature</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="3733e0bdb469ee96d11d363e4fd46920" href="#summary">const USB_MSD_STATE_DATA_OUT  = 2   </a></code></b>
				<p>	<pre>data out state (time for device to receive from host)</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="e13971347422026e74592a74f85bc80c" href="#summary">const word USB_EP0_OUT_ADDR = (USB_BASE_ADDRESS + 0x0010)</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="928722a61687b8954c1f6a8fa3df94fc" href="#summary">const byte USB_MSD_SENSE_MEDIUM_ERROR                     = 0x03</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="6378e9dffe92e3527bf83677c69ea84a" href="#summary">var volatile byte usb_msd_cbw_flags = 0   </a></code></b>
				<p>	<pre>must be volatile otherwise compiler throws it away</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="9b02960eac4e4d4d8ca7fb5210d240d6" href="#summary">var dword usb_msd_cbw_tag = 0             </a></code></b>
				<p>	<pre>relat a SBW with a CSW at end of packet</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="f09c5517bc07c80e9076e8d896df9e65" href="#summary">const word USB_EP1_IN_ADDR  = (0x0500)</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="5e2f3e99f51f154f271e74687beeb129" href="#summary">var dword usb_msd_sense_command_spacific</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="2d064e3a697333ff51ac72ddec991bb6" href="#summary">const byte USB_MSD_VERIFY                        = 0x2f</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="4fcd311eed06d3fe466c426a90aab290" href="#summary">var byte _usb_msd_csw_tag[4] at usb_msd_cbw_tag</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="40ca1521aec2fd33baf3eac7fdc8e725" href="#summary">var dword usb_msd_csw_signature = 0 </a></code></b>
				<p>	<pre>relate CSW with a SBW at the end of packet</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="4994fdcd1c95d9fbad0a80029bf634d6" href="#summary">const USB_MSD_CSW_STATUS_SUCCESS = 0x00  </a></code></b>
				<p>	<pre>command success</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="edf854794c36a3f3d846243bca226b9e" href="#summary">const byte USB_MSD_SENSE_ASCQ_WRITE_PROTECTED             = 0x00</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="8b27eecc7c12f43bdbd951f230f17245" href="#summary">const USB_CONFIGURATION_DESCRIPTOR_SIZE = 0x09 + 0x09 + 0x07 + 0x07</a></code></b>
				<p>	<pre>
Default USB_CONFIGURATION_DESCRIPTOR

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="d348170b021d8b85b2f9a41cf5c0cf7f" href="#summary">const byte USB_MSD_TEST_UNIT_READY               = 0x00</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="f100e88e869eca4dfd79e9d1d5a3bb58" href="#summary">var dword usb_msd_csw_tag = 0</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="520f3d85a3be89ff1c3728cc8dfc1991" href="#summary">var volatile byte reserve_array[0x10] at 0x400 + 256</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="6d666fde180a59de8feaf851bc21e82f" href="#summary">const word USB_EP0_IN_ADDR  = (USB_EP0_OUT_ADDR + USB_EP0_OUT_SIZE )</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="3d9b672ee766b6747f1b7282ee8d1891" href="#summary">const byte USB_MSD_SENSE_ASCQ_MEDIUM_NOT_PRESENT          = 0x00</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="ae7e03f76e789f5216f912067558e3ea" href="#summary">const byte USB_MSD_SENSE_ASC_INVALID_COMMAND_OPCODE       = 0x20</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="78af67d483b66f7370af9e2ac0b07673" href="#summary">var byte _usb_msd_sense_command_spacific[4] at usb_msd_sense_command_spacific</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="9493f411c0e91666f332578c77675a15" href="#summary">var bit usb_msd_sense_ili       at usb_msd_sense_filemark_eom_ili_reserved_key : 5</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="f7ea4c347f4a317f51214997ca3d450d" href="#summary">const byte USB_MSD_SENSE_UNIT_ATTENTION                   = 0x06</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="0218058a8f32297a0286ab7da18b64cf" href="#summary">const byte USB_MSD_SENSE_ASCQ_READ_ERROR                  = 0x00</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="298e4e960518498de15f01ebeac3c48c" href="#summary">const byte USB_STRING2[USB_STRING2_SIZE] =</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="1b1993ad50d4d762065a02b6432ee637" href="#summary">const USB_MSD_CSW = 0x53425355      </a></code></b>
				<p>	<pre>CSW variables
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="abf722eb33a18184b619d615c0b1b3c4" href="#summary">var bit usb_host_direction at usb_msd_cbw_flags : 7 </a></code></b>
				<p>	<pre>direction the host wishes to transefer</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="b4f2fdb41ae2ff012b3b30b7d57b2798" href="#summary">var word _usb_msd_step64 = 0</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="4db6e561efe29531f88430486831b5fb" href="#summary">var byte _usb_msd_sense_information[4] at usb_msd_sense_information</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="cb747f5582d88a083224be0c9964396b" href="#summary">var byte _usb_msd_data_residue[4] at usb_msd_data_residue</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="ef2b16f8e9113e628b67d9da0ac24365" href="#summary">const word USB_EP1_OUT_ADDR = (USB_EP0_IN_ADDR + USB_EP0_IN_SIZE)</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="528e1ed7461533e1ae8427e419e1918f" href="#summary">const byte USB_MSD_STOP_START                    = 0x1b</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="ca25b21349f66b70226ef27ccdb94e7b" href="#summary">const byte USB_EP1_OUT_SIZE = 64</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="38b4effbd21c4fe8b0207ab0fdf7bd1e" href="#summary">const byte USB_MSD_SENSE_ASCQ_LOGICAL_BLOCK_OUT_OF_RANGE  = 0x00</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="b4176cb10db2a420674e97f58547f73e" href="#summary">var dword usb_msd_cbw_data_transfer_length = 0 </a></code></b>
				<p>	<pre># of bytes of data that the host expects to transfer on the Bulk-In or Bulk-Out endpoint 1</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="f89039b5b2b915bec9867ef31ec7e659" href="#summary">const byte USB_DEVICE_DESCRIPTOR[USB_DEVICE_DESCRIPTOR_SIZE] =</a></code></b>
				<p>	<pre>
Default USB_DEVICE_DESCRIPTOR

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="c9d59aa17e5e5df4ca3a029ca212b0fe" href="#summary">var byte _usb_msd_block_size[4] at usb_msd_block_size</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="7af4c970934fc94148a092188a23afb8" href="#summary">var volatile byte usb_ep1in_buf[USB_EP1_IN_SIZE] at USB_EP1_IN_ADDR</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="6d43718deb635d7ff27f46783a3035a3" href="#summary">const byte USB_STRING3[USB_STRING3_SIZE] =</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="93999536c287f4cb04d19e007abf18b0" href="#summary">const byte USB_STRING0[] =</a></code></b>
				<p>	<pre>STRING 0
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="43e095c34b523179ed7b9ab7c4d645d4" href="#summary">const bit USB_EP2 = DISABLED</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="303a39f3c87de9f0d6f0ce01666955f0" href="#summary">const USB_MSD_STATE_WAIT      = 0   </a></code></b>
				<p>	<pre>msd status
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="e0bf24f59201a0f539ad2bff6aa281a3" href="#summary">var byte*16 usb_msd_cbw_command = 0       </a></code></b>
				<p>	<pre>command and parameters for a received CBW</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="41c104e461f50ebb03c150f9c33bcbcc" href="#summary">var dword _usb_msd_sector_step</a></code></b>
				<p>	<pre>variables
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="b7408e6c4e27778a832376927bfe3805" href="#summary">const USB_HOST_DIRECTION_RECEIVE = TRUE</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="dacaa454456c0494e8e00073b896d442" href="#summary">var byte usb_msd_temp at 0x400 + 255</a></code></b>
				<p>	<pre>fix some memory space so varibles don't get overwritten. needs a perminant fix
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="1764d1e2fdae0c3e595b37e4446ae216" href="#summary">const byte USB_MSD_SENSE_ASC_MEDIUM_NOT_PRESENT           = 0x3A</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="4fbf4a75a2e3392a1479141fad1c2e37" href="#summary">var bit*4 usb_msd_sense_key     at usb_msd_sense_filemark_eom_ili_reserved_key : 0</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="781bf4bf80611d5c6000b89e01706e65" href="#summary">var byte usb_msd_sense_filemark_eom_ili_reserved_key</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="51e1b453a6dd65dee20d612d9ce26528" href="#summary">const byte USB_MSD_SENSE_ASC_WRITE_PROTECTED              = 0x27</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="0e455db21d8f20144b2d84ce3e4253d3" href="#summary">var bit usb_msd_sense_eom       at usb_msd_sense_filemark_eom_ili_reserved_key : 6</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="bae8f460eb801cfbf91f7e14c618256c" href="#summary">var dword usb_msd_sense_information</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="3f8ff7092633a2f0ff627da5ffc3f5a7" href="#summary">var byte _usb_msd_cbw_data_transfer_length[4] at usb_msd_cbw_data_transfer_length</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="9c6e32cb57c0d5f7b567c81f11867442" href="#summary">var byte usb_msd_state  = USB_MSD_STATE_WAIT</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="efd0372f34ecbd54353d5a98c75aa544" href="#summary">const byte USB_MSD_SENSE_ASC_DEVICE_WRITE_FAULT           = 0x03</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="e5e43a20fb8f2abc020c3ff3a9fe59c2" href="#summary">const byte USB_STRING1[USB_STRING1_SIZE] =</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="d9bd64a31606020e57c8270f66078957" href="#summary">var byte _usb_msd_step_byte = 0</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
	</ul>


		<h3><a name="Procedures">Procedures</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a name="b2bda27169e63b6e4d7dcd487b1df262" href="#summary">usb_msd_wait_configured()</a></code></b>
				<p>	<pre>
Wait till msd is configured

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="8c612b9e2f1a9c7fa52379a5c99b184f" href="#summary">usb_msd_reset_sense_data()</a></code></b>
				<p>	<pre>
reset sense data. used for request sense command to
report our status

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="26c043dd07cc5d50f99833052c5fb800" href="#summary">usb_ep_data_out_callback(byte in end_point, word in buffer_addr, byte in byte_count)</a></code></b>
				<p>	<pre>
Handeles data going out of host to the PIC.

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="53e8d5e5c975b3b41bbafab71695b428" href="#summary">usb_msd_init()</a></code></b>
				<p>	<pre>
init procedure

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="9c7c2d10d3ff82b3edef0b4b0b31641c" href="#summary">msd_send_data(byte in size, bit in do_copy, bit in wait_own)</a></code></b>
				<p>	<pre>
send data to the host

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="745a8f83db9d3fc096870cf68cdc4319" href="#summary">msd_wait_own_tx()</a></code></b>
				<p>	<pre>DELAY must be checked -----------------------------------------------------------------------
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="cb5231cab1ade54cebf58ea5e5653fc5" href="#summary">usb_ep_data_in_callback(byte in end_point, word in buffer_addr, byte in byte_count)</a></code></b>
				<p>	<pre>
Handeles data going out from PIC and into the host.

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="23430b71941e0f5e25b74a8da9796830" href="#summary">usb_msd_tasks()</a></code></b>
				<p>	<pre>
Poll USB MSD for tasks

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="66922fe39db49ec3a1b28ff8e2ec34ec" href="#summary">msd_wait_own_rx()</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="75ed96f5e001fe5e243bed309816b479" href="#summary">usb_send_csw()</a></code></b>
				<p>	<pre>
send command status wrapper.
basically sends the status of a command that
was completed by the PIC.

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="54b2020647b644cf6d8d6abd992a3e98" href="#summary">usb_reset_callback()</a></code></b>
				<p>	<pre>
Reset Callback. Must add the following lines to USB_DRV reset procedure
if defined (usb_reset_callback) then
usb_reset_callback()
end if
with good code, you should not receive any resets from USB. You
will get a reset if you are slow to respond to a command

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="fa8375b23bb683a18973b8efdf73709f" href="#summary">usb_msd_command_received()</a></code></b>
				<p>	<pre>
Do whatever needs to be done with a command received.

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="cd9fda30b2d7d106c7c716165b971168" href="#summary">usb_msd_process_data()</a></code></b>
				<p>	<pre>
set the amount of data to be sent to the host through msd_send_data
and update the amount of data left to be sent.

</pre>
</p>
		</li>
	</ul>


		<h3><a name="Functions">Functions</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a name="4b58b0f09f00e58e3ae299ea91121c93" href="#summary">msd_cbw_is_valid() return bit</a></code></b>
				<p>	<pre>
Check if the CBW received is valid.

</pre>
</p>
		</li>
	</ul>



			<br/>
				<h2><a name="related_samples">Related samples</a></h2>
	Here are the list of samples which use this library:<br/><br/>
	<table border=1>
			<tr>
			<td><b>18f67j50</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/18f67j50_usb_msd_pata_hard_disk.jal" target="_blank">18f67j50_usb_msd_pata_hard_disk.jal</a></td>
			</tr>
			<tr>
			<td><b>18f67j50</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/18f67j50_usb_msd_sd_card.jal" target="_blank">18f67j50_usb_msd_sd_card.jal</a></td>
			</tr>
	</table>

			<br/>

            </div>
        </div>


	</body>
</html>

