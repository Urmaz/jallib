<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
    <head>
		<title>smbus_mlx90615 - jallib API doc</title>
    </head>
    <body>
		
		        <div id="page">
        
            <div id="pagecontent">

			    
	<a href="#toc" name="smbus_mlx90615">
    <h1>smbus_mlx90615</h1>
	</a>

    <div>
		<font size="+1"><i>SM bus library for Melexis IR sensor MLX90615</i></font>
	</div>

	<br/>

    <div class="narrow">
        
	<table>
	<tr>
		<td style="border: 1px solid #aaa; padding: 5px;">
			<b>Author</b>
		</td>
		<td style="border: 1px solid #aaa; padding: 5px;">
			Vasile Surducan, Copyright (c) 2010...2012, all rights reserved.
		</td>
	</tr>
	<tr>
		<td style="border: 1px solid #aaa; padding: 5px;">
			<b>Adapted-by</b>
		</td>
		<td style="border: 1px solid #aaa; padding: 5px;">
			
		</td>
	</tr>
	<tr>
		<td style="border: 1px solid #aaa; padding: 5px;">
			<b>Compiler</b>
		</td>
		<td style="border: 1px solid #aaa; padding: 5px;">
			>=2.4m
		</td>
	</tr>
	</table>

	<br/>
	
	<b>Description</b>
	<p>
		<pre>software implementation for single SMbus master, use 4 hw stack
</pre>

	</p>
	<br/>


	
	<b>Dependencies</b>
	<p>
		<ul>
			<li><a href="delay.html">delay</a></li>
		</ul>


			<br/>
				<h2><a name="summary">Summary</a></h2>

		<h3><a name="Global variables/contants">Global variables/contants</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a href="#69ac258150ca2c532f5b8dc396f3f412">const bit ACK = low
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#c4e11e7a930bd3a38ef7c4cd4e044446">var byte mem_high = 0
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#907543a392ab2190e6bb7d25268a906b">var sword temperature = 0
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#1594c1bebbeb0c659ac57a11e7167dae">const tobject = 0x07
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#2c1947823941d7a65343cd19f2a4de06">const id_number0 = 0x0E ; read only
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#6e696fb5960fc2edf998604bba197e3d">const smbus_sa = 0 ; SMbus Slave Address 7 bit, 0 to 6; 0x5b factory default
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#8ec5874b2af89db4d3862418b747530e">var volatile bit pwm_output_temp at config: 2 ; 1=Tambiant, 0=Tobject
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#5746d65b2d306128361086790c16ff9e">var sword temperature_c = 0
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#538d7290b62cdec86956400e0695d760">const sleep_mode = 0b1100_0110
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#a662eede37701f3bace82f581693ad30">const bit NACK = high
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#cba31e430a36b095026916323aeaad4f">const emissivity = 0x03
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#92349f6cd5d707eeb9f8a5c514a5eb31">var byte mem_low = 0
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#e751ae0a801e67ab70085c7f6eff208d">var byte nack_counter = 0
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#cca9d070c25eb6271ca3e1a7bbeba224">var word  w_t_high = 0
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#a6cead01e98ee292fab37d01083cbc30">const pwm_t_range = 0x01
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#2ed35e949cab5a331f2d08eeda1a750f">const id_number1 = 0x0F ; read only
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#a5e73a7266689f1275a008b91cbc0393">var volatile bit pwm_frequency at config: 1   ; 1=low,      0=high
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#a2d5faa155c55ab867dfbec9a623c396">var byte t_high = 0
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#26873c568f8fd427ec7cda8ca446ebf6">const config_reg = 0x02
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#3c11ca652232e7c36f6905661f6adeaf">var volatile bit*3 iir_setting at config: 12  ; see table below
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#cff89936e86718da031531dd04b52a12">var sword s_t_high = 0
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#dd43260b09361b05ef9ade559dc242d0">var byte pec = 0
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#9b787135d7357d653e50f4d5cdf975b1">var word config
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#9c357626dee0ef5e442d3c89c1143d04">const eeprom_access = 0b0001_0000
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#8ae3d5b04beaf10801fd1d9bf104fcbe">var volatile bit*9 factory_cal at config: 3   ; do not alter
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#444e7f3fe1d89dac820c6c79e1641dda">var word temperature_k = 0
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#c3fd8730a577fa09d275628589873dac">const sword c27315 = 27315
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#2ecb0d1b021c67effe3c21c8814af669">var word temp = 0
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#4afd9f2be81fd96f8691d837d3dc061d">const raw_ir_data = 0x05
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#c76af0b8ccb7fc824a2a17c75009b6fa">var volatile bit mode_select at config: 0     ; 1=SMbus,    0=PWM
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#643f79c818e9be5aef3464125baeb23a">var volatile bit zero at config: 15           ; keep 0
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#5984d3fea9a3bc0835a2747dc8addbef">const tambiant = 0x06
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#e19c99e926f40bf95018e7e1cd45ee6d">const ram_access = 0b0010_0000
</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#d2afe9c5e0f5199a69bd3d3c5dcd99eb">var bit mlx90615_ack = high
</a></code></b>
		</li>
	</ul>


		<h3><a name="Procedures">Procedures</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a href="#583cbd383a9b232d4014c96e0e14a555">mlx90615_sleep( byte in senzor_address )</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#0e20d32ab67d29b48380b48c44283ba5">calculate_temp_k()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#bc51cb36be52ba40de75df475e7099e9">mlx90615_wake()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#4db17884bfcecd6ddf264ae73f942e34">calculate_temp_c()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#80ef68402ff9b93e6882a34c27f59008">sm_start_bit()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#fe6fdecc9e3dc924e57aec338415d2b2">sm_stop_bit()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#983d1612cd8151a7232d049c3a126c2f">sm_bus_initialize() is ; not necesary if SMbus</a></code></b>
		</li>
	</ul>

	<i><small>Private</small></i>
		<ul>
		<li>
				<b><code name="code" class="python"><a href="#44fd9cbc42b89f1b72990d63acf44bd9">_scl_high()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#7345282c841729a55da968bb138f180c">_sda_high()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#f26ece046046f82c80fee8c1d81605fb">_scl_low()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#291116b748c8f4145f39ed029e1d9e57">_sm_send_bit(bit in x)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#29408f3c750ce7fce5108ce81d719128">_sda_low()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#5e1f97c3dfb29ea9d3ea146a4abd7308">_sm_receive_bit(bit out x)</a></code></b>
		</li>
	</ul>

	<br/>

		<h3><a name="Functions">Functions</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a href="#71c456199d43756c8711b24907bb894b">sm_transmit_byte(byte in tx_buffer) return bit</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#c2a5afd6da697205b63182b4d4eaf33b">sm_receive_byte(bit in ack_noack) return byte</a></code></b>
		</li>
	</ul>



			<br/>
				<h2><a name="api">API details</a></h2>

		<h3><a name="Global variables/contants">Global variables/contants</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a name="69ac258150ca2c532f5b8dc396f3f412" href="#summary">const bit ACK = low
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="c4e11e7a930bd3a38ef7c4cd4e044446" href="#summary">var byte mem_high = 0
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="907543a392ab2190e6bb7d25268a906b" href="#summary">var sword temperature = 0
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="1594c1bebbeb0c659ac57a11e7167dae" href="#summary">const tobject = 0x07
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="2c1947823941d7a65343cd19f2a4de06" href="#summary">const id_number0 = 0x0E ; read only
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="6e696fb5960fc2edf998604bba197e3d" href="#summary">const smbus_sa = 0 ; SMbus Slave Address 7 bit, 0 to 6; 0x5b factory default
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="8ec5874b2af89db4d3862418b747530e" href="#summary">var volatile bit pwm_output_temp at config: 2 ; 1=Tambiant, 0=Tobject
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="5746d65b2d306128361086790c16ff9e" href="#summary">var sword temperature_c = 0
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="538d7290b62cdec86956400e0695d760" href="#summary">const sleep_mode = 0b1100_0110
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="a662eede37701f3bace82f581693ad30" href="#summary">const bit NACK = high
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="cba31e430a36b095026916323aeaad4f" href="#summary">const emissivity = 0x03
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="92349f6cd5d707eeb9f8a5c514a5eb31" href="#summary">var byte mem_low = 0
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="e751ae0a801e67ab70085c7f6eff208d" href="#summary">var byte nack_counter = 0
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="cca9d070c25eb6271ca3e1a7bbeba224" href="#summary">var word  w_t_high = 0
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="a6cead01e98ee292fab37d01083cbc30" href="#summary">const pwm_t_range = 0x01
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="2ed35e949cab5a331f2d08eeda1a750f" href="#summary">const id_number1 = 0x0F ; read only
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="a5e73a7266689f1275a008b91cbc0393" href="#summary">var volatile bit pwm_frequency at config: 1   ; 1=low,      0=high
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="a2d5faa155c55ab867dfbec9a623c396" href="#summary">var byte t_high = 0
</a></code></b>
				<p>	<pre>var byte t_low = 0
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="26873c568f8fd427ec7cda8ca446ebf6" href="#summary">const config_reg = 0x02
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="3c11ca652232e7c36f6905661f6adeaf" href="#summary">var volatile bit*3 iir_setting at config: 12  ; see table below
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="cff89936e86718da031531dd04b52a12" href="#summary">var sword s_t_high = 0
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="dd43260b09361b05ef9ade559dc242d0" href="#summary">var byte pec = 0
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="9b787135d7357d653e50f4d5cdf975b1" href="#summary">var word config
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="9c357626dee0ef5e442d3c89c1143d04" href="#summary">const eeprom_access = 0b0001_0000
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="8ae3d5b04beaf10801fd1d9bf104fcbe" href="#summary">var volatile bit*9 factory_cal at config: 3   ; do not alter
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="444e7f3fe1d89dac820c6c79e1641dda" href="#summary">var word temperature_k = 0
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="c3fd8730a577fa09d275628589873dac" href="#summary">const sword c27315 = 27315
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="2ecb0d1b021c67effe3c21c8814af669" href="#summary">var word temp = 0
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="4afd9f2be81fd96f8691d837d3dc061d" href="#summary">const raw_ir_data = 0x05
</a></code></b>
				<p>	<pre> 0x04 to 0x4h Melexis reserved
</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="c76af0b8ccb7fc824a2a17c75009b6fa" href="#summary">var volatile bit mode_select at config: 0     ; 1=SMbus,    0=PWM
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="643f79c818e9be5aef3464125baeb23a" href="#summary">var volatile bit zero at config: 15           ; keep 0
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="5984d3fea9a3bc0835a2747dc8addbef" href="#summary">const tambiant = 0x06
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="e19c99e926f40bf95018e7e1cd45ee6d" href="#summary">const ram_access = 0b0010_0000
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="d2afe9c5e0f5199a69bd3d3c5dcd99eb" href="#summary">var bit mlx90615_ack = high
</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
	</ul>


		<h3><a name="Procedures">Procedures</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a name="583cbd383a9b232d4014c96e0e14a555" href="#summary">mlx90615_sleep( byte in senzor_address )</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="0e20d32ab67d29b48380b48c44283ba5" href="#summary">calculate_temp_k()</a></code></b>
				<p>	<pre>conversion to kelvin

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="bc51cb36be52ba40de75df475e7099e9" href="#summary">mlx90615_wake()</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="4db17884bfcecd6ddf264ae73f942e34" href="#summary">calculate_temp_c()</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="80ef68402ff9b93e6882a34c27f59008" href="#summary">sm_start_bit()</a></code></b>
				<p>	<pre>
SMbus start bit

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="fe6fdecc9e3dc924e57aec338415d2b2" href="#summary">sm_stop_bit()</a></code></b>
				<p>	<pre>
SMbus stop bit

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="983d1612cd8151a7232d049c3a126c2f" href="#summary">sm_bus_initialize() is ; not necesary if SMbus</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
	</ul>

	<i><small>Private</small></i>
		<ul>
		<li>
				<b><code name="code" class="python"><a name="44fd9cbc42b89f1b72990d63acf44bd9" href="#summary">_scl_high()</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="7345282c841729a55da968bb138f180c" href="#summary">_sda_high()</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="f26ece046046f82c80fee8c1d81605fb" href="#summary">_scl_low()</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="291116b748c8f4145f39ed029e1d9e57" href="#summary">_sm_send_bit(bit in x)</a></code></b>
				<p>	<pre>
Transmit one bit on SM bus (for internal use only )

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="29408f3c750ce7fce5108ce81d719128" href="#summary">_sda_low()</a></code></b>
				<p><i>No documentation found</i></p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="5e1f97c3dfb29ea9d3ea146a4abd7308" href="#summary">_sm_receive_bit(bit out x)</a></code></b>
				<p>	<pre>
Receive one bit on SM bus (for internal use only)

</pre>
</p>
		</li>
	</ul>

	<br/>

		<h3><a name="Functions">Functions</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a name="71c456199d43756c8711b24907bb894b" href="#summary">sm_transmit_byte(byte in tx_buffer) return bit</a></code></b>
				<p>	<pre>
Transmit one byte on SM bus

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="c2a5afd6da697205b63182b4d4eaf33b" href="#summary">sm_receive_byte(bit in ack_noack) return byte</a></code></b>
				<p>	<pre>
Receive one byte on SM bus

</pre>
</p>
		</li>
	</ul>



			<br/>
				<h2><a name="related_samples">Related samples</a></h2>
	Here are the list of samples which use this library:<br/><br/>
	<table border=1>
			<tr>
			<td><b>18f25j10</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/18f25j10_test_mlx90615.jal" target="_blank">18f25j10_test_mlx90615.jal</a></td>
			</tr>
	</table>

			<br/>

            </div>
        </div>


	</body>
</html>

