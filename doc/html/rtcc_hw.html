<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
    <head>
		<title>rtcc_hw - jallib API doc</title>
    </head>
    <body>
		
		        <div id="page">
        
            <div id="pagecontent">

			    
	<a href="#toc" name="rtcc_hw">
    <h1>rtcc_hw</h1>
	</a>

    <div>
		<font size="+1"><i>Support for builtin RealTimeClockCalendar (RTCC) module of 18FxxJxx.</i></font>
	</div>

	<br/>

    <div class="narrow">
        
	<table>
	<tr>
		<td style="border: 1px solid #aaa; padding: 5px;">
			<b>Author</b>
		</td>
		<td style="border: 1px solid #aaa; padding: 5px;">
			Rob Hamerling, Copyright (c) 2010..2011, all rights reserved.
		</td>
	</tr>
	<tr>
		<td style="border: 1px solid #aaa; padding: 5px;">
			<b>Adapted-by</b>
		</td>
		<td style="border: 1px solid #aaa; padding: 5px;">
			
		</td>
	</tr>
	<tr>
		<td style="border: 1px solid #aaa; padding: 5px;">
			<b>Compiler</b>
		</td>
		<td style="border: 1px solid #aaa; padding: 5px;">
			2.4n
		</td>
	</tr>
	</table>

	<br/>
	
	<b>Description</b>
	<p>
		<pre>RealTimeClock support:
  - routines for control of realtime clock and alarm
.
This library supports:
  - RTCC modules like in 18fxxj11, 18fxxj50 and several other PICs.
.
Available procedures and functions for application programs
(not all of these may be implemented yet!).
.
Time/clock related operations:
  - rtc_set_clock()              -- enable/disable RTCC module
  - rtc_calibrate()              -- compensate crystal frequency aberration
  - rtc_pin_signal()             -- RTCC output pin signal control
  - rtc_get_date()               -- year,month,day (bcd)
  - rtc_set_date()
  - rtc_get_time()               -- hour,minute,second (bcd)
  - rtc_set_time()
  - rtc_get_secondofday()        -- second of day (binary)
  - rtc_get_minuteofday()        -- minute of day (binary)
  - rtc_get_dayofweek()          -- day of week number (binary)
  - rtc_get_dayofmonth()         -- day of month (binary)
  - rtc_get_dayofyear()          -- day of year (binary)
.
Alarm related operations:
  - rtc_set_alarm()              -- enable/disable alarm
  - rtc_get_alarm_date()         -- alarm month,day (bcd), no year!
  - rtc_set_alarm_date()
  - rtc_get_alarm_time()         -- alarm hour,minute,second (bcd)
  - rtc_set_alarm_time()
  - rtc_set_alarm_dayofweek()
  - rtc_set_alarm_interval()     -- alarm interval (binary)
  - rtc_set_alarm_repeat()       -- alarm repeat (binary)
.
General purpose functions and procedures:
  - bcd2bin()                   -- convert byte from bcd to binary
  - mult60()                    -- hours -> minutes; minutes -> seconds
.
The RTCC uses bcd notation for year, month, day, hour, minute and
second (all of these are byte variables).
.
Bytes in bcd-notation can easily be displayed with print_byte_hex()
of the Jallib print library.
.
For the compare of dates and times (for smaller or larger) the
library provides some functions which return binary values for
minute or second of the day, day of the week, day of the month
and day of the year.
</pre>

	</p>
	<br/>


	
	<b>Dependencies</b>
	<p>
		<i>No dependency found</i>
	</p>
	<br/>


			<br/>
				<h2><a name="summary">Summary</a></h2>

		<h3><a name="Global variables/contants">Global variables/contants</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a href="#8f2505861c1f958bfe2f467f105a3e9c">var  byte  _alrm_sec        = 0x00              </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#ff8bc511bb5d2b10958e7bc0ca9b4531">var  byte  _rtc_min         = 0x00              </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#1454999eef7da4e5e7c9115a0568e1e2">var  byte  _rtc_hour        = 0x00              </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#6ff954dda6b3bcfc250fe44813f8b689">var  byte  _alrm_hour       = 0x00              </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#b4edb40603a038808c59c2a4f11aef6e">var  byte  _alrm_month      = 0x01              </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#bde45a63f91b09bfaf0825e015d2f592">var  byte  _alrm_dayofweek  = 0x00              </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#0f1f8253d9475f5ec42bb4efada15b3e">var  byte  _alrm_dayofmonth = 0x01              </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#5f0d017ce8e5afe88b05c75618356a2a">var  byte  _rtc_year        = 0x00              </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#269c168dbeaf45516b6d2a89fb96b0ab">var  byte  _alrm_min        = 0x00              </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#f520056384faccfc95b05ef6f9dc7f56">var  byte  _rtc_dayofmonth  = 0x01              </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#a750d7b4fae09c8296ff8b14587aea73">var  byte  _rtc_month       = 0x01              </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#99cba3fb2042ddb1d7e3d1fabdac782b">var  byte  _rtc_sec         = 0x00              </a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#5d89afb59ef72e64791144ca5b41eda7">var  byte  _rtc_dayofweek                       </a></code></b>
		</li>
	</ul>


		<h3><a name="Procedures">Procedures</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a href="#ee69ae408df446564d69bf2b27dd2593">rtc_calibrate(sbyte in calibration)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#0f29eb9f5294c7b0e8cf174c962ba37e">rtc_set_alarm_interval(byte in interval)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#3c0c6ae17789dbf8fc17ac5ff5ebb206">rtc_set_alarm_dayofweek(byte in weekday)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#24475560168547664c2ac290be285c89">rtc_set_alarm(bit in state)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#17efad3466b31ebca131675b68e463be">rtc_set_alarm_repeat(byte in repeats)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#ebf1f261242ba82755b8184cb5912521">rtc_pin_signal(bit*2 in pin_signal_selection_mask)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#bea3eae599b901ccb669590b5d3ee631">rtc_set_clock(bit in state)</a></code></b>
		</li>
	</ul>

	<i><small>Private</small></i>
		<ul>
		<li>
				<b><code name="code" class="python"><a href="#8cdf0ffbfa28cd3ad7ab8303c7a92e91">_rtc_read()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#e37e95eb8c92e1ffabbe79886dbe98ea">_rtc_write_control(bit in control)</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#401820f16c0733b99699f04cbc3ac70b">_rtc_write()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#8839242b18181e0974b32e919e3c24da">_rtc_alrm_read()</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#4d2f3c54fde609b55ffbd8fb1c191c9d">_rtc_alrm_write()</a></code></b>
		</li>
	</ul>

	<br/>

		<h3><a name="Functions">Functions</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a href="#c3c1bfdac92da4c1cd9cf18062ef9280">mult60(word in x) return dword</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#88b4b7a5d4ccb83c81b0cf50a7a613a4">rtc_get_dayofweek() return byte</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#0f5a08da507d3d6f7bb8fdd74e787a1c">rtc_get_dayofyear() return word</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#cae71ba413889a057ed94c71ade7b1a1">rtc_get_minuteofday() return word</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#c53c48ce7630280b23d854bee9bd0f77">bcd2bin(byte in bcd) return byte</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#fa815be534d81c00451bc425f4a9cc74">rtc_get_secondofday() return dword</a></code></b>
		</li>
		<li>
				<b><code name="code" class="python"><a href="#5274b75d6591eb46861defb8f9d9c188">rtc_get_dayofmonth() return byte</a></code></b>
		</li>
	</ul>



			<br/>
				<h2><a name="api">API details</a></h2>

		<h3><a name="Global variables/contants">Global variables/contants</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a name="8f2505861c1f958bfe2f467f105a3e9c" href="#summary">var  byte  _alrm_sec        = 0x00              </a></code></b>
				<p>	<pre>alarm second</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="ff8bc511bb5d2b10958e7bc0ca9b4531" href="#summary">var  byte  _rtc_min         = 0x00              </a></code></b>
				<p>	<pre>minute</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="1454999eef7da4e5e7c9115a0568e1e2" href="#summary">var  byte  _rtc_hour        = 0x00              </a></code></b>
				<p>	<pre>hour</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="6ff954dda6b3bcfc250fe44813f8b689" href="#summary">var  byte  _alrm_hour       = 0x00              </a></code></b>
				<p>	<pre>alarm hour</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="b4edb40603a038808c59c2a4f11aef6e" href="#summary">var  byte  _alrm_month      = 0x01              </a></code></b>
				<p>	<pre>alarm month</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="bde45a63f91b09bfaf0825e015d2f592" href="#summary">var  byte  _alrm_dayofweek  = 0x00              </a></code></b>
				<p>	<pre>alarm day of week</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="0f1f8253d9475f5ec42bb4efada15b3e" href="#summary">var  byte  _alrm_dayofmonth = 0x01              </a></code></b>
				<p>	<pre>alarm day</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="5f0d017ce8e5afe88b05c75618356a2a" href="#summary">var  byte  _rtc_year        = 0x00              </a></code></b>
				<p>	<pre>
Global variables internally used by rtcc and alarm functions and procedures.
Not to be accessed by application programs!

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="269c168dbeaf45516b6d2a89fb96b0ab" href="#summary">var  byte  _alrm_min        = 0x00              </a></code></b>
				<p>	<pre>alarm minute</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="f520056384faccfc95b05ef6f9dc7f56" href="#summary">var  byte  _rtc_dayofmonth  = 0x01              </a></code></b>
				<p>	<pre>day of month</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="a750d7b4fae09c8296ff8b14587aea73" href="#summary">var  byte  _rtc_month       = 0x01              </a></code></b>
				<p>	<pre>month</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="99cba3fb2042ddb1d7e3d1fabdac782b" href="#summary">var  byte  _rtc_sec         = 0x00              </a></code></b>
				<p>	<pre>second</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="5d89afb59ef72e64791144ca5b41eda7" href="#summary">var  byte  _rtc_dayofweek                       </a></code></b>
				<p>	<pre>day of week</pre>
</p>
		</li>
	</ul>


		<h3><a name="Procedures">Procedures</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a name="ee69ae408df446564d69bf2b27dd2593" href="#summary">rtc_calibrate(sbyte in calibration)</a></code></b>
				<p>	<pre>
Calibrate the RTCC module.
input: calibration value
output: none
returns: nothing
note: Calibration value is a signed byte  (-128..+127).
A negative value must be specified when the crystal is too fast.
See datasheet for the calculation of the amount.

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="0f29eb9f5294c7b0e8cf174c962ba37e" href="#summary">rtc_set_alarm_interval(byte in interval)</a></code></b>
				<p>	<pre>
Set alarm interval.
input: alarm_interval with a RTC_ALARM_INTERVAL_xxxx mask
(see the defined RTC_ALARM_INTERVAL_xxxx masks above)
output: none
returns: nothing

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="3c0c6ae17789dbf8fc17ac5ff5ebb206" href="#summary">rtc_set_alarm_dayofweek(byte in weekday)</a></code></b>
				<p>	<pre>
Set alarm time.
input: day-of-week of alarm (binary, 0..6)
output: none
returns: nothing
Notes: When setting the alarm date the alarm interval is
by default set to once a week on the specified day of the week.
You may want to set the alarm time first, or control the
alarm interval separately.

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="24475560168547664c2ac290be285c89" href="#summary">rtc_set_alarm(bit in state)</a></code></b>
				<p>	<pre>
Enable or disable alarm.
input: alarm_state (bit): true  - enable alarm
false - disable alarm
output: none
returns: nothing

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="17efad3466b31ebca131675b68e463be" href="#summary">rtc_set_alarm_repeat(byte in repeats)</a></code></b>
				<p>	<pre>
Set alarm repetition.
input: repeats: number of times to repeat alarm signal (binary)
output: none
returns: nothing
notes: The following will happen after an alarm condition:
 with repeat value 0 there will be 1 alarm event
 with repeat values 1..254 there will be as many more alarm
events as specified with <repeats>
(at intervals as specified with rtc_set_alarm_interval() )
 with repeat value 255 there will be indefinite alarm events
The ALRMCFG_ALRMEN bit will be cleared after the last alarm event
(thus never with repeat value 255).

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="ebf1f261242ba82755b8184cb5912521" href="#summary">rtc_pin_signal(bit*2 in pin_signal_selection_mask)</a></code></b>
				<p>	<pre>
Select the RTCC output pin signal functionality.
input: 2-bits mask: one of the RTC_PIN_xxxx constants (see above)
output: none
returns: nothing
notes: - With 'NONE' pin_RTCC is released and available for I/O
 See the datasheet for the meaning of the different masks.

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="bea3eae599b901ccb669590b5d3ee631" href="#summary">rtc_set_clock(bit in state)</a></code></b>
				<p>	<pre>
Enable or disable the RTCC module.
input: none
output: none
returns: nothing
notes: The T1 oscillator is enable/disabled too!

</pre>
</p>
		</li>
	</ul>

	<i><small>Private</small></i>
		<ul>
		<li>
				<b><code name="code" class="python"><a name="8cdf0ffbfa28cd3ad7ab8303c7a92e91" href="#summary">_rtc_read()</a></code></b>
				<p>	<pre>
Read the realtime clock.
input:  none
output: none
returns: nothing
notes: read clock/calendar registers into local variables

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="e37e95eb8c92e1ffabbe79886dbe98ea" href="#summary">_rtc_write_control(bit in control)</a></code></b>
				<p>	<pre>
Enable or disable RTCC register writes.
input: bit (enable / disable)
output: none
returns: nothing
notes:  (Re)setting the RTCWREN bit in RTCCFG requires a strict
sequence, see datasheets for details.
JalV2 2.4n and 2.4o(beta) generate the correct sequences
with the code below.

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="401820f16c0733b99699f04cbc3ac70b" href="#summary">_rtc_write()</a></code></b>
				<p>	<pre>
Write the realtime clock.
input:  none
output: none
returns: nothing
notes: - enable writing to RTC registers
 write clock/calendar registers
 disable writes

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="8839242b18181e0974b32e919e3c24da" href="#summary">_rtc_alrm_read()</a></code></b>
				<p>	<pre>
Read the alarm setting.
input:  none
output: none
returns: nothing
notes: read alarm registers into local variables

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="4d2f3c54fde609b55ffbd8fb1c191c9d" href="#summary">_rtc_alrm_write()</a></code></b>
				<p>	<pre>
Write the alarm time of realtime clock.
input:  none
output: none
returns: nothing
notes: - disable alarm
 write alarm registers from local variables
 restore alarm state

</pre>
</p>
		</li>
	</ul>

	<br/>

		<h3><a name="Functions">Functions</a></h3>
		<ul>
		<li>
				<b><code name="code" class="python"><a name="c3c1bfdac92da4c1cd9cf18062ef9280" href="#summary">mult60(word in x) return dword</a></code></b>
				<p>	<pre>
Multiply a word by 60 (typically for minutes to seconds or hours to minutes)
input:   byte with binary data
output:  none
returns: word with product
notes: - (x * 60) -> x * (64 - 4) -> (x * 64) - (x * 4)
 algorithm without multiplication
 word as input, dword as returnvalue chosen for
relative second of day (function rtc_hhmmss_bin())

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="88b4b7a5d4ccb83c81b0cf50a7a613a4" href="#summary">rtc_get_dayofweek() return byte</a></code></b>
				<p>	<pre>
Get day of week.
input: none
output: none
returns: day of the week (binary byte 0..6)

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="0f5a08da507d3d6f7bb8fdd74e787a1c" href="#summary">rtc_get_dayofyear() return word</a></code></b>
				<p>	<pre>
Get day of year.
input: none
output: none
returns: number of days sinece 1st of January (binary word 0..365)

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="cae71ba413889a057ed94c71ade7b1a1" href="#summary">rtc_get_minuteofday() return word</a></code></b>
				<p>	<pre>
Get minute of day.
input: none
output: none
returns: number of minutes since midnight (binary word)

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="c53c48ce7630280b23d854bee9bd0f77" href="#summary">bcd2bin(byte in bcd) return byte</a></code></b>
				<p>	<pre>======================================================================
General purpose functions / procedures
======================================================================

Convert one byte packed bcd to one byte binary.
input:   byte with bcd data
output:  none
returns: byte with binary value of bcd byte
notes: - A byte in bcd notation contains ((16 * tens) + ones).
To convert it to a binary value: subtract (6 * tens)
Algorithm is modeled after an assembler version of
Scott Dattalo at PicList (but slightly less efficient!).

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="fa815be534d81c00451bc425f4a9cc74" href="#summary">rtc_get_secondofday() return dword</a></code></b>
				<p>	<pre>
Get second of day.
input: none
output: none
returns: number of seconds since midnight (binary dword)

</pre>
</p>
		</li>
		<li>
				<b><code name="code" class="python"><a name="5274b75d6591eb46861defb8f9d9c188" href="#summary">rtc_get_dayofmonth() return byte</a></code></b>
				<p>	<pre>
Get day of month.
input: none
output: none
returns: number of days since 1st of the month (binary byte 0..30)

</pre>
</p>
		</li>
	</ul>



			<br/>
				<h2><a name="related_samples">Related samples</a></h2>
	Here are the list of samples which use this library:<br/><br/>
	<table border=1>
			<tr>
			<td><b>18f26j11</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/18f26j11_rtcc_hw_kbd_lcd.jal" target="_blank">18f26j11_rtcc_hw_kbd_lcd.jal</a></td>
			</tr>
			<tr>
			<td><b>18f27j53</b></td><td><a href="http://code.google.com/p/jallib/source/browse/trunk/sample/18f27j53_rtcc_hw_alarm.jal" target="_blank">18f27j53_rtcc_hw_alarm.jal</a></td>
			</tr>
	</table>

			<br/>

            </div>
        </div>


	</body>
</html>

