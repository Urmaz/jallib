-- ------------------------------------------------------
-- Title: Blink-a-led of the Microchip pic16f877
--
-- Author: Rob Hamerling, Copyright (c) 2008..2010, all rights reserved.
--
-- Adapted-by:
--
-- Compiler: 2.4n
--
-- This file is part of jallib  (http://jallib.googlecode.com)
-- Released under the BSD license (http://www.opensource.org/licenses/bsd-license.php)
--
-- Description:
-- Sample blink-a-led program for Microchip PIC16f877.
--
-- Sources:
--
-- Notes:
--  - File creation date/time: 15 Nov 2010 20:05:09.
--
-- ------------------------------------------------------
--
-- include chip
include 18F4620                   -- target picmicro
-- this program assumes a 20 mhz resonator or crystal
-- is connected to pins osc1 and osc2.
pragma target osc INTOSC_NOCLKOUT              -- hs crystal or resonator
;pragma target osc hs              -- hs crystal or resonator
;pragma target clock 20_000_000    -- oscillator frequency
pragma target clock 32_000_000    -- oscillator frequency
--
pragma target wdt  disabled
pragma target lvp  disabled
pragma target MCLR external        -- reset externally
--;
;OSCCON_IRCF = 0b110   -- set int osc to 4mhz
OSCCON_IRCF = 0b111   -- set internal osc to 8mhz
OSCTUNE_PLLEN = true  -- multiply internal osc by 4
;--
enable_digital_io()                -- make all pins digital I/O
--
_usec_delay(100_000) -- wait for power to settle

-- Specify the pin to which the LED (with serial resistor!) is connected:
alias   led      is pin_A0
pin_A0_direction =  output
--

led = low
_usec_delay(5_000_000)

-- set the led level
procedure set_level_1(byte in level) is
  led = level -- set led level
end procedure

var byte test
var word pointer = whereis(set_level_1)

assembler
   movf test,1
   call set_level_1
end assembler

;var byte test = 1
;test = 2
_usec_delay(5_000_000)
set_level_1(low)


